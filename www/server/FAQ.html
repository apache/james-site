<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>James Server - 
    Frequently Asked Questions</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
          <meta name="author" content="
    James Project Web Team" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://james.apache.org/index.html" id="bannerLeft">
    
                                            <img src="images/james-server-logo.gif" alt="" />
    
            </a>
                        <a href="http://www.apache.org/index.html" id="bannerRight">
    
                                            <img src="images/asf-logo-reduced.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        Last Published: 07/26/2006
                      </div>
            <div class="xright">      <a href="http://james.apache.org/index.html">JAMES Project</a>
          |
          <a href="">Server</a>
          |
          <a href="http://james.apache.org/jspf/index.html">jSPF</a>
          |
          <a href="http://james.apache.org/mime4j/index.html">Mime4J</a>
          |
          <a href="http://james.apache.org/jsieve/index.html">JSieve</a>
          |
          <a href="http://james.apache.org/postage/index.html">Postage</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>James</h5>
        <ul>
              
    <li class="none">
              <a href="index.html">Overview</a>
        </li>
              
    <li class="none">
              <strong>James FAQ</strong>
        </li>
              
    <li class="none">
              <a href="mail.html">Mailing Lists</a>
        </li>
              
    <li class="none">
              <a href="http://wiki.apache.org/james">Wiki</a>
        </li>
          </ul>
          <h5>Documentation</h5>
        <ul>
              
    <li class="none">
              <a href="documentation_2_1.html">James</a>
        </li>
              
    <li class="none">
              <a href="design_objectives.html">Design</a>
        </li>
              
    <li class="none">
              <a href="document_archive.html">Document Archive</a>
        </li>
          </ul>
          <h5>Documentation 2.3B</h5>
        <ul>
              
    <li class="none">
              <a href="documentation_2_3.html">James</a>
        </li>
              
    <li class="none">
              <a href="design_objectives_2_3.html">Design</a>
        </li>
              
    <li class="none">
              <a href="apidocs/index.html">James Javadocs</a>
        </li>
              
    <li class="none">
              <a href="rfclist.html">Useful RFCs</a>
        </li>
          </ul>
          <h5>Project</h5>
        <ul>
              
    <li class="none">
              <a href="http://issues.apache.org/jira/browse/JAMES">Bug Database</a>
        </li>
              
    <li class="none">
              <a href="http://svn.apache.org/viewvc/james/server/">Source Code</a>
        </li>
              
    <li class="none">
              <a href="changelog.html">Changelog</a>
        </li>
              
    <li class="none">
              <a href="todo.html">TODO</a>
        </li>
          </ul>
          <h5>Project Documentation</h5>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>
              
                
              
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-reports.html">Project Reports</a>
              </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
  
    <a name="This FAQ"></a><div class="section"><h2>This FAQ</h2>
      <P>This is a living document that provides answers to common questions about James, installation, configuration, admin and running not already answered in the documentation. Last Updated January 2005.</P>
    </div>
    <a name="Questions"></a><div class="section"><h2>Questions</h2>
      <p>
        <ul>
          <li>
            <a href="#1">How do I set up a mailing list</a>
          </li>
          <li>
            <a href="#2">Is James an Open Relay for Spam?</a>
          </li>
          <li>
            <a href="#3">I can send messages to James, but nobody is receiving them.  What do I do?</a>
          </li>
          <li>
            <a href="#4">I can send people messages via James, but nobody can send me messages.  What do I do?</a>
          </li>
          <li>
            <a href="#5">I'm trying to debug messages that James is trying to deliver.  Where should I look?</a>
          </li>
          <li>
            <a href="#6">What about IMAP support?</a>
          </li>
          <li>
            <a href="#7">What about support virtual hosting?</a>
          </li>
          <li>
            <a href="#8">Where do I stick classes and jars?</a>
          </li>
          <li>
            <a href="#9">How do I upgrade to a newer version of James?</a>
          </li>
          <li>
            <a href="#10">How do I run James as an NT/2k/XP service?</a>
          </li>
          <li>
            <a href="#11">Why isn't my mailet making changes to a MimeMessage?</a>
          </li>
          <li>
            <a href="#12">How to remove unneeded services like NNTP, POP3?</a>
          </li>
          <li>
            <a href="#13">How can I contribute to James?</a>
          </li>
          <li>
            <a href="#14">How can I make sendmail route local mail (or all mail) through James on the same machine?</a>
          </li>
          <li>
            <a href="#15">I am using Microsoft's SQL Type 4 JDBC Driver, why do I get a &quot;Can't start manual transaction mode because there are cloned connections&quot; exception?</a>
          </li>
          <li>
            <a href="#16">I am using James with a MySQL database and I keep getting a &quot;Packet is larger than max_allowed_packet&quot; when receiving large messages despite the fact that my max packet size is configured to be larger than my max message size.  What's going on?</a>
          </li>
          <li>
            <a href="#17">How do I use Subversion to get James source code?</a>
          </li>
        </ul>
      
    </div>
    <a name="Answers"></a><div class="section"><h2>Answers</h2>
      <a name="1"></a>
      <a name="Would you please teach me how to set up a mailing list"></a><div class="section"><h3>Would you please teach me how to set up a mailing list</h3>
        James currently (v2.1) includes only the most basic list functionality, users can subscribe and unsubscribe, but there is no moderation of messages or subscriptions
        To enable a list you need the following in config.xml in the root processor block and above the final mailet block -
        <div class="source"><pre>
&lt;mailet match=&quot;CommandForListserv=james@localhost&quot;
    class=&quot;AvalonListservManager&quot;&gt;
    &lt;repositoryName&gt;list-james&lt;/repositoryName&gt;
&lt;/mailet&gt;
</pre></div>
        that will intercept the command emails sent to
<ul>
            <li>james-on@localhost to subscribe the sender</li>
            <li>james-off@localhost to unsubscribe the sender</li>
          </ul>
        
        and-
        <div class="source"><pre>
&lt;mailet match=&quot;RecipientIs=james@localhost&quot; class=&quot;AvalonListserv&quot;&gt;
    &lt;membersonly&gt; false &lt;/membersonly&gt;
    &lt;attachmentsallowed&gt; true &lt;/attachmentsallowed&gt;
    &lt;replytolist&gt; true &lt;/replytolist&gt;
    &lt;repositoryName&gt;list-james&lt;/repositoryName&gt;
    &lt;subjectprefix&gt;JamesList&lt;/subjectprefix&gt;
&lt;/mailet&gt;
</pre></div>
        Which will distribute the mail to the current subscribers
        in addition to the above you need to have a repository configured in the users-store block(usually near the bottom of config.xml) like so (database)-
        <div class="source"><pre>
&lt;repository name=&quot;list-james&quot;
    class=&quot;org.apache.james.userrepository.ListUsersJdbcRepository&quot;
    destinationURL=&quot;db://maildb/lists/list-james&quot;&gt;
    &lt;sqlFile&gt;file://conf/sqlResources.xml&lt;/sqlFile&gt;
&lt;/repository&gt;
</pre></div>
        Database users will also need to ensure that they have <a href="using_database_2_1.html">configured a data-source</a> named to match the destination URL
        Using the filesystem:-
        <div class="source"><pre>
&lt;repository name=&quot;list-james&quot;
    class=&quot;org.apache.james.userrepository.UsersFileRepository&quot;&gt;
    &lt;destination URL=&quot;file://var/lists/list-james/&quot;/&gt;
&lt;/repository&gt;
</pre></div>
        Restart James, send a mail to james-on@localhost and you should be subscribed.
        The repository, be it a database table or directory in the filesystem will be created automatically.
        Database users can manipulate the users repository using SQL, and hence any application capable of running SQL queries against it.
      </div>
      <a name="2"></a>
      <a name="James seems to be an open relay for Spam, is it?"></a><div class="section"><h3>James seems to be an open relay for Spam, is it?</h3>
        In some simple tests of mail relays James appears to be an open relay, properly configured it is not. 
        Because James is an email application platform it currently accepts all mail delivered to it via SMTP for processing. Only after the mail has been recieved does this processing begin.
        This means that James accepts Spam. However the default configuration, and any sensible re-configuration has a number of anti-spam measures which will prevent the re-transmisson of spam from James. This makes it a blackhole for spam.
        This also means that James will not verify addresses, but of course this means that valid addresses can't be harvested from James by spammers either.
      </div>
      <a name="3"></a>
      <a name="I can send messages to James, but nobody is receiving them.  What do I do?"></a><div class="section"><h3>I can send messages to James, but nobody is receiving them.  What do I do?</h3>
        Check that you've added valid DNS servers to your James installation.  Email delivery requires the use of special mail related DNS information (MX records), so James needs to explicitly be given DNS servers.  Look at your config.xml file for a &lt;dnsserver&gt; section and add one or more DNS servers.
        Additionally, check the RemoteAddrNotInNetwork matcher under&lt;processor name=&quot;transport&quot;&gt;. By default it looks like this:
        <div class="source"><pre>
&lt;mailet match=&quot;RemoteAddrNotInNetwork=127.0.0.1&quot; class=&quot;ToProcessor&quot;&gt;
    &lt;processor&gt; spam &lt;/processor&gt;
&lt;/mailet&gt;
</pre></div>
        because most mail programs will use the external IP address (as opposed to 127.0.0.1) when processing mail, you need to add your internal network and/or your static IP address to this list.  You may also use a DNS domain name in this list.  The resulting entry would look something like this:
        <div class="source"><pre>
&lt;mailet match=&quot;RemoteAddrNotInNetwork=127.0.0.1,192.168.1.*&quot;
        class=&quot;ToProcessor&quot;&gt;
    &lt;processor&gt; spam &lt;/processor&gt;
&lt;/mailet&gt;
</pre></div>
        <p>This tells the processor that anything not in this address list should go to the spam processor.</p>
        <p>Please note that if you wish to configure James to allow users to send email from any domain or IP address you will need to disable this matcher.  In this situation you must use SMTP AUTH to ensure that your server does not act as an open relay.  For more on open relays, please see <a href="http://www.ordb.org">the Open Relay Database</a>.</p>
      </div>
      <a name="4"></a>
      <a name="I can send people messages via James, but nobody can send me messages.  What do I do?"></a><div class="section"><h3>I can send people messages via James, but nobody can send me messages.  What do I do?</h3>
        <p>You need to do one of two things:
               <ol type="1">
            <li>Update your domain's DNS entries so there are MX records that point to the machine that is running James.  Note that it is illegal for MX records to point to IP addresses.  You need to point MX records to a valid CNAME or A name entry, and then map that eventually to an IP address.</li>
            <li>You could alternatively give people an email address with IP addresses.  Most people will think it's a very strange email address, but hello@[192.168.0.1] is a valid email address.  Note that you need to wrap the IP address in brackets.</li>
          </ol>
        
      </div>
      <a name="5"></a>
      <a name="I'm trying to debug messages that James is trying to deliver.  Where should I look?"></a><div class="section"><h3>I'm trying to debug messages that James is trying to deliver.  Where should I look?</h3>
        First step is to look in the log directory at the mailet.log file.  Look for entries that include the text &quot;RemoteDelivery&quot;.  This should provide some high-level debug information of James' attempt to delivery mail remotely.
        <p>If you want to delve into the code, look at the RemoteDelivery mailet.  You may also want to review the mail repository source code for the repository type you are using (file, db, etc...).</p>
      </div>
      <a name="6"></a>
      <a name="What about IMAP support?"></a><div class="section"><h3>What about IMAP support?</h3>
        <p>IMAP development had been stalled, but has recently attracted new activity.  IMAP support is scheduled for inclusion in James v3.  In the meantime, there is experimental code in the repository.  If you are interested in working on or trying the IMAP prototype code, join the james-dev mailing list and let us know.</p>
      </div>
      <a name="7"></a>
      <a name="What about support virtual hosting?"></a><div class="section"><h3>What about support virtual hosting?</h3>
        <p>James v2.1 includes a new mailet for database users, <a href="javadocs/org/apache/james/transport/mailets/JDBCVirtualUserTable.html">JDBCVirtualUserTable</a>, that mimics some of the sendmail capabilities of the same name.</p>
        <p>JDBCVirtualUserTable does not provide any administation tools.
You'll have to create and maintain the database table yourself.  The
standard configuration is as follows:</p>
        <div class="source"><pre>
CREATE TABLE VirtualUserTable
(
 user varchar(64) NOT NULL default '',
 domain varchar(255) NOT NULL default '',
 target_address varchar(255) NOT NULL default '',
 PRIMARY KEY (user,domain)
);
</pre></div>
        <p>The standard query used with VirtualUserTable is:</p>
        <div class="source"><pre>
select VirtualUserTable.target_address from VirtualUserTable, VirtualUserTable as VUTDomains
where (VirtualUserTable.user like ? or VirtualUserTable.user like &quot;\%&quot;)
and (VirtualUserTable.domain like ?
or (VirtualUserTable.domain like &quot;\%&quot; and VUTDomains.domain like ?))
order by concat(VirtualUserTable.user,'@',VirtualUserTable.domain) desc limit 1
</pre></div>
        <p>For a given [user, domain, domain] used with the query, this will
match as follows (in precedence order):
<ol type="1">
            <li>user@domain    - explicit mapping for user@domain</li>
            <li>user@%         - catchall mapping for user anywhere</li>
            <li>%@domain       - catchall mapping for anyone at domain</li>
            <li>null           - no valid mapping</li>
          </ol>
        
        A sample mailet looks like:
        <div class="source"><pre>
&lt;mailet match=&quot;All&quot; class=&quot;JDBCVirtualUserTable&quot;&gt;
  &lt;table&gt;db://maildb/VirtualUserTable&lt;/table&gt;
&lt;/mailet&gt;
</pre></div>
        More generalized viirtual hosting is something the developers are still discussing.  One issue is that POP3 does not support virtual hosting in that it does not have a command to indicate what domain the user is in.  What this means is the mail server needs to support a 'mapping' or 'translation' convention, e.g., 'user1@domaina.com' gets a username 'domaina.user1'.  This allows the mail server to have a single username namespace.  We have seen a few good proposals put forward, but nothing that seemed the clear solution, as ideally we could have this part solve the next issue.
        Beyond that, James needs to refine virtual hosting for mailet processing.  With the current user model, the mailet API has a Mail.getUser() method that no longer would be useable as a reliable indicator of whether they were in the local username namespace.  To date we are unclear of the best way to bring this translation into the mailet processing.  Similarly, it would be nice to support different mailet processing based on the domain, although this is somewhat feasible using the limited processing flow offered with a HostIs matcher.
        <p>Virtual hosting is one of the most requested features, and additional work is scheduled for the 3.0 release.</p>
      </div>
      <a name="8"></a>
      <a name="Where do I stick classes and jars?"></a><div class="section"><h3>Where do I stick classes and jars?</h3>
        <p>We are largely reliant on what Avalon is doing in terms of classloading, but here are a few tips and suggestions:
  <ul>
            <li>Stick jars in the james/lib directory and add them to the classpath in run.bat or run.sh.</li>
            <li>Instructions for including classes for custom mailets and matchers can be found <a href="custom_mailet_2_1.html">here</a> and <a href="custom_matcher_2_1.html">here</a> respectively..</li>
          </ul>
  Eventually we hope to support mailet reloading and a special lib and classes directory within the james directory that custom mailets can load from, but for now these are hopefully some useful tips.
      </div>
      <a name="9"></a>
      <a name="How do I upgrade to a newer version of James?"></a><div class="section"><h3>How do I upgrade to a newer version of James?</h3>
        
          <ol type="1">
            <li>Rename the previous james directory into a james.old</li>
            <li>Run phoenix to let the new james.sar be deployed.</li>
            <li>Edit the newly deployed config.xml to reflect your customizations from the previous config.xml.</li>
            <li>If using JDBC, see <a href="http://wiki.apache.org/james/UpgradingToAttributes">necessary table changes.</a>
            </li>
            <li>Replace the var directory by the previous var directory.  This will copy over user accounts, inboxes, spools, and whatever else.</li>
            <li>Restart James.</li>
          </ol>
        
      </div>
      <a name="10"></a>
      <a name="How do I run James as an NT/2k/XP service?"></a><div class="section"><h3>How do I run James as an NT/2k/XP service?</h3>
        The version of Avalon Phoenix distributed with James v2.1 and later includes a <a href="http://avalon.apache.org/phoenix/guide-administrator.html">wrapper</a> that lets you run James as a service.  An alternative strategy is to install the <a href="http://www.alexandriasc.com/software/JavaService/index.html">JavaService</a> from Alexandia Software.
      </div>
      <a name="11"></a>
      <a name="Why isn't my mailet making changes to a MimeMessage?"></a><div class="section"><h3>Why isn't my mailet making changes to a MimeMessage?</h3>
        Check the JavaMail docs.  Per the API, when you call MimeMessage.setContent(blah), you have to call saveChanges() to apply your changes.  James tries to automatically call this method so you don't have to, but in certain cases you'll still have to call saveChanges().
      </div>
      <a name="12"></a>
      <a name="How to remove unneeded services like NNTP, POP3?"></a><div class="section"><h3>How to remove unneeded services like NNTP, POP3?</h3>
        The following information is based on James 2.0a3, but the
             upcoming 2.1 version should be similar.
        NNTP and other underlying services are called &quot;blocks&quot; in the
             Avalon Phoenix terminology. Blocks are specified in the
             assembly.xml file which is located in the apps/james/SAR-INF directory (2.1)
             or apps/james/conf directory (2.0a3). Note: this file is created
             during the first startup of James.
        There are dependencies between the blocks, which you can read from
             the file. For example the SMTP Server block depends on the
             users-store block, so if you want SMTP then you cannot remove the
             users-store block even if you only want to relay messages.
        To remove the NNTP Server comment out the following blocks:
             NNTP server, NNTP Authentication Service, NNTP repository.
             To remove the POP3 Server comment out the POP3 Server block.
        <p>If you remove a block it wont't be loaded next time you restart
             James. You must also remove all sections related to the removed
             blocks from the James configuration file - config.xml - otherwise
             you will get error messages, saying that there is no corresponding
             block.</p>
      </div>
      <a name="13"></a>
      <a name="How can I contribute to James"></a><div class="section"><h3>How can I contribute to James</h3>
        <p>Read the &quot;Contributors How To&quot; <a href="contribute.html">here</a>
        </p>
      </div>
      <a name="14"></a>
      <a name="How can I make sendmail route local mail (or all mail) through James on the same machine?"></a><div class="section"><h3>How can I make sendmail route local mail (or all mail) through James on the same machine?</h3>
        <p>Read the &quot;sendmail How To&quot; <a href="james_and_sendmail.html">here</a>
        </p>
      </div>
      <a name="15"></a>
      <a name="I am using Microsoft's SQL Type 4 JDBC Driver, why do I get a "Can't start manual transaction mode because there are cloned connections" exception?"></a><div class="section"><h3>I am using Microsoft's SQL Type 4 JDBC Driver, why do I get a &quot;Can't start manual transaction mode because there are cloned connections&quot; exception?</h3>
        <p>I am using Microsoft's SQL Type 4 JDBC Driver, why do I get the following exception?<br></br>java.sql.SQLException: [Microsoft][SQLServer 2000 Driver for JDBC]Can't start manual transaction mode because there are cloned connections.</p>
        <p>This seems to be a problem with the Microsoft Type 4 JDBC Driver and concurrent statements/transactions/resultsets on the same database conntection.</p>
        <p>To solve this you need to add <b>;SelectMethod=cursor</b> to the end of your dburl string. Your dburl string would then look something like this<br></br>&lt;dburl&gt;jdbc:microsoft:sqlserver://dbserver.host.name:1433;SelectMethod=cursor&lt;/dburl&gt;</p>
        <p>NOTE: some people have complained about performance when using this option, the alternative is a 3rd party JDBC driver but these are often not free.</p>
      </div>
      <a name="16"></a>
      <a name="I am using James with a MySQL database and I keep getting a "Packet is larger than max_allowed_packet" when receiving large messages despite the fact that my max packet size is configured to be larger than my max message size.  What's going on?"></a><div class="section"><h3>I am using James with a MySQL database and I keep getting a &quot;Packet is larger than max_allowed_packet&quot; when receiving large messages despite the fact that my max packet size is configured to be larger than my max message size.  What's going on?</h3>
        <p>When a user tries to send a large message that is close to but not quite at the max message limit the send fails and an exception similar to the following appears in the log:</p>
        <p>Sent: 451 Error processing message:<br></br>
            Exception spooling message: Exception caught while storing mail Container:<br></br>
            java.lang.IllegalArgumentException: Packet is larger than max_allowed_packet<br></br>
            from server configuration of 4193280 bytes;<br></br>
              nested exception is:<br></br>
                    java.lang.RuntimeException: Exception caught while storing mail<br></br>
            Container: java.lang.IllegalArgumentException: Packet is larger than<br></br>
            max_allowed_packet from server configuration of 4193280 bytes<br></br>
        </p>
        <p>Because of how the JDBC driver is written, a 25%
            factor is necessary between the maximum message size and the max_packet_size
            to prevent the driver from throwing an exception.  So if you want a 4MB
            maximum message size, you need a 5MB max_packet size.  Or a 4MB
            max_packet_size allows only a 3.2MB max message.
            </p>
      </div>
      <a name="17"></a>
        <a name="How do I use Subversion to get James source code?"></a><div class="section"><h3>How do I use Subversion to get James source code?</h3>
          <p>First of all read this: <a href="http://www.apache.org/dev/version-control.html">ASF Source Code</a>.
          <br></br>Now go to <a href="http://subversion.tigris.org/">http://subversion.tigris.org/</a> and download a subversion client.
          <br></br>James subversion repository is at <b>http://svn.apache.org/repos/asf/james/server</b>. Commiters use &quot;https&quot;.
          <br></br>You may want to search the web, our <a href="http://www.mail-archive.com/server-dev@james.apache.org/">dev</a> and <a href="http://www.mail-archive.com/server-user@james.apache.org/">user</a> mail archives or our <a href="http://wiki.apache.org/james">wiki</a> for more information.</p>
        </div>
    </div>
  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2002-2006
    
          Apache Software Foundation
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
