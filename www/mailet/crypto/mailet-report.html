<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Apache JAMES Crypto - TITLE</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://james.apache.org/mailets/crypto/index.html" id="bannerLeft">
    
                                            <img src="images/james-crypto-mailets-logo.gif" alt="" />
    
            </a>
                        <a href="http://www.apache.org/index.html" id="bannerRight">
    
                                            <img src="images/asf-logo-reduced.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        Last Published: 08/25/2008
                      </div>
            <div class="xright">      <a href="../../index.html">JAMES Project</a>
          |
          <a href="../../server/index.html">Server</a>
          |
          <a href="../../mailet/index.html">Mailets</a>
          |
          <a href="../../jspf/index.html">jSPF</a>
          |
          <a href="../../mime4j/index.html">Mime4J</a>
          |
          <a href="../../jsieve/index.html">JSieve</a>
          |
          <a href="../../postage/index.html">Postage</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>Cryptography Mailets</h5>
        <ul>
              
    <li class="none">
              <a href="index.html">Overview</a>
        </li>
              
    <li class="none">
              <a href="conf.html">Configuration</a>
        </li>
              
    <li class="none">
              <strong>Catalog</strong>
        </li>
              
    <li class="none">
              <a href="doap_crypto-mailets.rdf">DOAP</a>
        </li>
          </ul>
          <h5>Mailets</h5>
        <ul>
              
    <li class="none">
              <a href="http://james.apache.org/mailet/api/">API</a>
        </li>
              
    <li class="none">
              <a href="http://james.apache.org/mailet/base/">Basic Toolkit</a>
        </li>
              
    <li class="none">
              <a href="http://james.apache.org/mailet/standard/">Standard</a>
        </li>
              
    <li class="none">
              <a href="">Crypto</a>
        </li>
          </ul>
          <h5>Project Documentation</h5>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>
              
                
              
      
            
            
            
      
            
      
            
      
            
      
              
            <li class="expanded">
              <a href="project-reports.html">Project Reports</a>
                <ul>
                  
    <li class="none">
              <a href="apidocs/index.html">JavaDocs</a>
        </li>
                  
    <li class="none">
              <strong>Mailet Reference</strong>
        </li>
                  
    <li class="none">
              <a href="rat-report.html">RAT Report</a>
        </li>
                  
    <li class="none">
              <a href="xref/index.html">Source Xref</a>
        </li>
                  
    <li class="none">
              <a href="surefire-report.html">Surefire Report</a>
        </li>
                  
    <li class="none">
              <a href="taglist.html">Tag List</a>
        </li>
              </ul>
        </li>
          </ul>
          <h5>Downloads</h5>
        <ul>
              
    <li class="none">
              <a href="../../download.cgi">Stable releases</a>
        </li>
              
    <li class="none">
              <a href="../../downloadunstable.cgi">Unstable releases</a>
        </li>
              
    <li class="none">
              <a href="http://people.apache.org/builds/james/nightly/">Nightly builds</a>
        </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Mailets and Matchers</h2><div class="section"><h3>KeyStoreHolder</h3><p>This class is used to handle in a simple way a keystore that contains a set
of trusted certificates. It loads the set from the specified keystore (type,
location and password are supplied during the object's creation) and it is
able to verify a s/mime signature, also checking if the signer's certificate
is trusted or not.</p></div><div class="section"><h3>IsSMIMESigned</h3><p>checks if a mail is smime signed.</p></div><div class="section"><h3>SMIMESign</h3><p>Mailet Info: <b>SMIME Signature Mailet</b></p><p><p>Puts a <I>server-side</I> SMIME signature on a message.<br>
It is a concrete subclass of {@link Sign}, with very few modifications to it,
to specialize for SMIME.</p>

<P>Handles the following init parameters (will comment only the differences from {@link AbstractSign}):</P>
<ul>
<li>&lt;debug&gt;.</li>
<li>&lt;keyStoreFileName&gt;.</li>
<li>&lt;keyStorePassword&gt;.</li>
<li>&lt;keyAlias&gt;.</li>
<li>&lt;keyAliasPassword&gt;.</li>
<li>&lt;keyStoreType&gt;.</li>
<li>&lt;postmasterSigns&gt;. The default is <CODE>true</CODE>.</li>
<li>&lt;rebuildFrom&gt;. The default is <CODE>true</CODE>.</li>
<li>&lt;signerName&gt;.</li>
<li>&lt;explanationText&gt;. There is a default explanation string template in English,
displaying also all the headers of the original message (see {@link #getExplanationText}).</li>
</ul></p></div><div class="section"><h3>IsX509CertificateSubject</h3><p><p>
Checks if the subject of a X509Certificate contains the supplied string. The
certificate is read from the specified mail attribute.
</p><p>
If the specified attribute contains more than one certificate the matcher matches if at
least one of the certificates contains the given string.
</p>
<p>
Configuration string:
<ul>
<li>mailAttribute;string</li>
</ul></p></div><div class="section"><h3>Sign</h3><p>Mailet Info: <b>Signature Mailet</b></p><p><p>Puts a <I>server-side</I> signature on a message.<br>
It is a concrete subclass of {@link AbstractSign}, with very few modifications to it.</p>
<p>A text file with an explanation text is attached to the original message,
and the resulting message with all its attachments is signed.
The resulting appearence of the message is almost unchanged: only an extra attachment
and the signature are added.</p>
<p>The kind of signuture depends on the value of the &lt;keyHolderClass&gt; init parameter.

<P>Handles the following init parameters (will comment only the differences from {@link AbstractSign}):</P>
<ul>
<li>&lt;keyHolderClass&gt;: Sets the class of the KeyHolder object that will handle the cryptography functions,
for example org.apache.james.security.SMIMEKeyHolder for SMIME.</li>
<li>&lt;debug&gt;.</li>
<li>&lt;keyStoreFileName&gt;.</li>
<li>&lt;keyStorePassword&gt;.</li>
<li>&lt;keyAlias&gt;.</li>
<li>&lt;keyAliasPassword&gt;.</li>
<li>&lt;keyStoreType&gt;.</li>
<li>&lt;postmasterSigns&gt;. The default is <CODE>true</CODE>.</li>
<li>&lt;rebuildFrom&gt;. The default is <CODE>true</CODE>.</li>
<li>&lt;signerName&gt;.</li>
<li>&lt;explanationText&gt;. There is a default explanation string template in English,
displaying also all the headers of the original message (see {@link #getExplanationText}).</li>
</ul></p></div><div class="section"><h3>InitJCE</h3><p>Security Providers initialization class. The first call of the init method
will have the class loader do the job. This technique ensures proper
initialization without the need of maintaining the
<i>${java_home}/lib/security/java.security</i> file, that would otherwise
need the addition of the following line:
<code>security.provider.<i>n</i>=org.bouncycastle.jce.provider.BouncyCastleProvider</code>.

The call also registers to the javamail's MailcapCommandMap the content
handlers that are needed to work with s/mime mails.</p></div><div class="section"><h3>SMIMEDecrypt</h3><p>This mailet decrypts a s/mime encrypted message. It takes as input an
encrypted message and it tries to dechiper it using the key specified in its
configuration. If the decryption is successful the mail will be changed and
it will contain the decrypted message. The mail attribute
<code>org.apache.james.SMIMEDecrypt</code> will contain the public
certificate of the key used in the process.

The configuration parameters of this mailet are summarized below. The firsts
define the keystore where the key that will be used to decrypt messages is
saved.
<ul>
<li>keyStoreType (default: system dependent): defines the type of the store.
Usually jks, pkcs12 or pkcs7</li>
<li>keyStoreFileName (mandatory): private key store path.</li>
<li>keyStorePassword (default: ""): private key store password</li>
</ul>
The other parameters define which private key have to be used. (if the store
contains more than one key).
<ul>
<li>keyAlias: private key alias.</li>
<li>keyPass: private key password</li>
</ul></p></div><div class="section"><h3>SMIMESignerInfo</h3><p>Licensed to the Apache Software Foundation (ASF) under one *
or more contributor license agreements. See the NOTICE file *
distributed with this work for additional information *
regarding copyright ownership. The ASF licenses this file *
to you under the Apache License, Version 2.0 (the *
"License"); you may not use this file except in compliance *
with the License. You may obtain a copy of the License at *
*
http://www.apache.org/licenses/LICENSE-2.0 *
*
Unless required by applicable law or agreed to in writing, *
software distributed under the License is distributed on an *
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY *
KIND, either express or implied. See the License for the *
specific language governing permissions and limitations *
under the License. *</p></div><div class="section"><h3>SMIMECheckSignature</h3><p><p>
Verifies the s/mime signature of a message. The s/mime signing ensure that
the private key owner is the real sender of the message. To be checked by
this mailet the s/mime signature must contain the actual signature, the
signer's certificate and optionally a set of certificate that can be used to
create a chain of trust that starts from the signer's certificate and leads
to a known trusted certificate.
</p>
<p>
This check is composed by two steps: firstly it's ensured that the signature
is valid, then it's checked if a chain of trust starting from the signer
certificate and that leads to a trusted certificate can be created. The first
check verifies that the the message has not been modified after the signature
was put and that the signer's certificate was valid at the time of the
signing. The latter should ensure that the signer is who he declare to be.
</p>
<p>
The results of the checks perfomed by this mailet are wrote as a mail
attribute which default name is org.apache.james.SMIMECheckSignature (it can
be changed using the mailet parameter <code>mailAttribute</code>). After
the check this attribute will contain a list of SMIMESignerInfo object, one
for each message's signer. These objects contain the signer's certificate and
the trust path.
</p>
<p>
Optionally, specifying the parameter <code>strip</code>, the signature of
the message can be stripped after the check. The message will become a
standard message without an attached s/mime signature.
</p>
<p>
The configuration parameter of this mailet are summerized below. The firsts
defines the location, the format and the password of the keystore containing
the certificates that are considered trusted. Note: only the trusted certificate
entries are read, the key ones are not.
<ul>
<li>keyStoreType (default: jks): Certificate store format . "jks" is the
standard java certificate store format, but pkcs12 is also quite common and
compatible with standard email clients like Outlook Express and Thunderbird.
<li>keyStoreFileName (default: JAVA_HOME/jre/lib/security/cacert): Certificate
store path.
<li>keyStorePassword (default: ""): Certificate store password.
</ul>
Other parameters configure the behavior of the mailet:
<ul>
<li>strip (default: false): Defines if the s/mime signature of the message
have to be stripped after the check or not. Possible values are true and
false.
<li>mailAttribute (default: org.apache.james.SMIMECheckSignature):
specifies in which attribute the check results will be written.
<li>onlyTrusted (default: true): Usually a message signature to be
considered by this mailet as authentic must be valid and trusted. Setting
this mailet parameter to "false" the last condition is relaxed and also
"untrusted" signature are considered will be considered as authentic.
</ul>
</p></p></div><div class="section"><h3>SMIMEAttributeNames</h3><p>Contains some SMIME related mail attribute names of general use.</p></div><div class="section"><h3>KeyHolder</h3><p><p>Interface to an object that will do cryptographic activity on a MimeMessage,
and contains the needed cryptographic key.</p>
<p>The implementing objects have the role of being a simpler intermediate to the crypto libraries.</p></p></div><div class="section"><h3>SMIMEKeyHolder</h3><p><p>Loads a {@link java.security.KeyStore} in memory and keeps it ready for the
cryptographic activity.</p>
<p>It has the role of being a simpler intermediate to the crypto libraries.
Uses specifically the <a href="http://www.bouncycastle.org/">Legion of the Bouncy Castle</a>
libraries, particularly for the SMIME activity.</p></p></div><div class="section"><h3>IsSMIMEEncrypted</h3><p>Checks if a mail is smime encrypted.</p></div><div class="section"><h3>AbstractSign</h3><p><P>Abstract mailet providing common SMIME signature services.<BR>
It can be subclassed to make authoring signing mailets simple.<BR>
By extending it and overriding one or more of the following methods a new behaviour can
be quickly created without the author having to address any issue other than
the relevant one:</P>
<ul>
<li>{@link #initDebug}, {@link #setDebug} and {@link #isDebug} manage the debugging mode.</li>
<li>{@link #initExplanationText}, {@link #setExplanationText} and {@link #getExplanationText} manage the text of
an attachment that will be added to explain the meaning of this server-side signature.</li>
<li>{@link #initKeyHolder}, {@link #setKeyHolder} and {@link #getKeyHolder} manage the {@link KeyHolder} object that will
contain the keys and certificates and will do the crypto work.</li>
<li>{@link #initPostmasterSigns}, {@link #setPostmasterSigns} and {@link #isPostmasterSigns}
determines whether messages originated by the Postmaster will be signed or not.</li>
<li>{@link #initRebuildFrom}, {@link #setRebuildFrom} and {@link #isRebuildFrom}
determines whether the "From:" header will be rebuilt to neutralize the wrong behaviour of
some MUAs like Microsoft Outlook Express.</li>
<li>{@link #initSignerName}, {@link #setSignerName} and {@link #getSignerName} manage the name
of the signer to be shown in the explanation text.</li>
<li>{@link #isOkToSign} controls whether the mail can be signed or not.</li>
<li>The abstract method {@link #getWrapperBodyPart} returns the massaged {@link javax.mail.internet.MimeBodyPart}
that will be signed, or null if the message has to be signed "as is".</li>
</ul>

<P>Handles the following init parameters:</P>
<ul>
<li>&lt;keyHolderClass&gt;: Sets the class of the KeyHolder object that will handle the cryptography functions,
for example org.apache.james.security.SMIMEKeyHolder for SMIME.</li>
<li>&lt;debug&gt;: if <CODE>true</CODE> some useful information is logged.
The default is <CODE>false</CODE>.</li>
<li>&lt;keyStoreFileName&gt;: the {@link java.security.KeyStore} full file name.</li>
<li>&lt;keyStorePassword&gt;: the <CODE>KeyStore</CODE> password.
If given, it is used to check the integrity of the keystore data,
otherwise, if null, the integrity of the keystore is not checked.</li>
<li>&lt;keyAlias&gt;: the alias name to use to search the Key using {@link java.security.KeyStore#getKey}.
The default is to look for the first and only alias in the keystore;
if zero or more than one is found a {@link java.security.KeyStoreException} is thrown.</li>
<li>&lt;keyAliasPassword&gt;: the alias password. The default is to use the <CODE>KeyStore</CODE> password.
At least one of the passwords must be provided.</li>
<li>&lt;keyStoreType&gt;: the type of the keystore. The default will use {@link java.security.KeyStore#getDefaultType}.</li>
<li>&lt;postmasterSigns&gt;: if <CODE>true</CODE> the message will be signed even if the sender is the Postmaster.
The default is <CODE>false</CODE>.</li></li>
<li>&lt;rebuildFrom&gt;: If <CODE>true</CODE> will modify the "From:" header.
For more info see {@link #isRebuildFrom}.
The default is <CODE>false</CODE>.</li>
<li>&lt;signerName&gt;: the name of the signer to be shown in the explanation text.
The default is to use the "CN=" property of the signing certificate.</li>
<li>&lt;explanationText&gt;: the text of an explanation of the meaning of this server-side signature.
May contain the following substitution patterns (see also {@link #getReplacedExplanationText}):
<CODE>[signerName]</CODE>, <CODE>[signerAddress]</CODE>, <CODE>[reversePath]</CODE>, <CODE>[headers]</CODE>.
It should be included in the signature.
The actual presentation of the text depends on the specific concrete mailet subclass:
see for example {@link SMIMESign}.
The default is to not have any explanation text.</li>
</ul></p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          The Apache Software Foundation
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      _uacct = "UA-1384591-1";
      urchinTracker();
    </script>
  </body>
</html>
