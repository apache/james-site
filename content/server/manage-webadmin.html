<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.    
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at 2019-01-30 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Apache James Project &#x2013; Web administration for JAMES</title>
    <style type="text/css" media="all">
      @import url("../css/james.css");
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
      @import url("../js/jquery/css/custom-theme/jquery-ui-1.8.5.custom.css");
      @import url("../js/jquery/css/print.css");
      @import url("../js/fancybox/jquery.fancybox-1.3.4.css");
    </style>
    <script type="text/javascript" src="../js/jquery/js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="../js/jquery/js/jquery-ui-1.8.5.custom.min.js"></script>
    <script type="text/javascript" src="../js/fancybox/jquery.fancybox-1.3.4.js"></script>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20190130" />
    <meta http-equiv="Content-Language" content="en" />
        
          <!-- Google Analytics -->
    <script type="text/javascript">
    
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1384591-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script').item(0); s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../index.html" id="bannerLeft" title="james-logo.png">
              
                                                                            
        <img src="../images/logos/james-logo.png" alt="James Project" />
                </a>
                              <a href="http://www.apache.org/index.html" id="bannerRight">
              
                                        
        <img src="images/logos/asf_logo_small.png" alt="The Apache Software Foundation" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 2019-01-30</span>
                      </div>
            <div class="xright">                    <a href="../index.html" title="Home">Home</a>
            |
                        <a href="../documentation.html" title="James">James</a>
            |
                        <a href="../mime4j/index.html" title="Mime4J">Mime4J</a>
            |
                        <a href="../jsieve/index.html" title="jSieve">jSieve</a>
            |
                        <a href="../jspf/index.html" title="jSPF">jSPF</a>
            |
                        <a href="../jdkim/index.html" title="jDKIM">jDKIM</a>
            |
                        <a href="../hupa/index.html" title="Hupa">Hupa</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>James components</h5>
                  <ul>
                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../documentation.html" title="About James">About James</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="../server/index.html" title="Server">Server</a>
                    <ul>
                      <li class="none">
                          <a href="../server/advantages.html" title="Advantages">Advantages</a>
            </li>
                      <li class="none">
                          <a href="../server/objectives.html" title="Objectives">Objectives</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="expanded">
                          <a href="../server/quick-start.html" title="User Manual">User Manual</a>
                    <ul>
                                                                                                                                                                                    <li class="collapsed">
                          <a href="../server/features.html" title="1. Features">1. Features</a>
                  </li>
                      <li class="none">
                          <a href="../server/packaging.html" title="2. Packaging">2. Packaging</a>
            </li>
                                                                                                                              <li class="collapsed">
                          <a href="../server/install.html" title="3. Install James">3. Install James</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../server/config.html" title="4. Configure James">4. Configure James</a>
                  </li>
                                                                                                                      <li class="expanded">
                          <a href="../server/manage.html" title="5. Manage">5. Manage</a>
                    <ul>
                      <li class="none">
            <strong>WebAdmin</strong>
          </li>
                      <li class="none">
                          <a href="../server/manage-cli.html" title="Command line">Command line</a>
            </li>
                      <li class="none">
                          <a href="../server/metrics.html" title="Metrics">Metrics</a>
            </li>
              </ul>
        </li>
                                                                                                            <li class="collapsed">
                          <a href="../server/monitor.html" title="6. Monitor">6. Monitor</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../server/upgrade.html" title="7. Upgrade">7. Upgrade</a>
                  </li>
                                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../server/dev.html" title="8. Developers Corner">8. Developers Corner</a>
                  </li>
              </ul>
        </li>
                      <li class="none">
                          <a href="../mail.html#James_Mailing_lists" title="Mailing Lists">Mailing Lists</a>
            </li>
                      <li class="none">
                          <a href="../server/release-notes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../server/apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
                      <li class="none">
                          <a href="https://issues.apache.org/jira/browse/JAMES" title="Issue Tracker">Issue Tracker</a>
            </li>
                      <li class="none">
                          <a href="https://github.com/apache/james-project" title="Sources">Sources</a>
            </li>
                      <li class="none">
                          <a href="../server/rfcs.html" title="RFCs">RFCs</a>
            </li>
                      <li class="none">
                          <a href="../server/other-versions.html" title="Other versions">Other versions</a>
            </li>
                      <li class="none">
                          <a href="../download.cgi#Apache_James_Server" title="Download releases">Download releases</a>
            </li>
              </ul>
        </li>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../mailet/index.html" title="Mailets">Mailets</a>
                  </li>
                                                                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="../mailbox/index.html" title="Mailbox">Mailbox</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../protocols/index.html" title="Protocols">Protocols</a>
                  </li>
                                                                                                                                                                                                        <li class="collapsed">
                          <a href="../mpt/index.html" title="MPT">MPT</a>
                  </li>
          </ul>
        <h5>Apache Software Foundation</h5>
  <ul>
    <li>
      <strong>
        <a title="ASF" href="http://www.apache.org/">ASF</a>
      </strong>
    </li>
    <li>
      <a title="Get Involved" href="http://www.apache.org/foundation/getinvolved.html">Get Involved</a>
    </li>
    <li>
      <a title="FAQ" href="http://www.apache.org/foundation/faq.html">FAQ</a>
    </li>
    <li>
      <a title="License" href="http://www.apache.org/licenses/" >License</a>
    </li>
    <li>
      <a title="Sponsorship" href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
    </li>
    <li>
      <a title="Thanks" href="http://www.apache.org/foundation/thanks.html">Thanks</a>
    </li>
    <li>
      <a title="Security" href="http://www.apache.org/security/">Security</a>
    </li>
  </ul>
                       <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Web administration for JAMES</h1>
<p>The web administration supports for now the CRUD operations on the domains, the users, their mailboxes and their quotas,  managing mail repositories, performing cassandra migrations, and much more, as described in the following sections.</p>
<p><b>WARNING</b>: This API allow authentication only via the use of JWT. If not configured with JWT, an administrator should ensure an attacker can not use this API.</p>
<p>By the way, some endpoints are not filtered by authentication. Those endpoints are not related to data stored in James, for example: Swagger documentation &amp; James health checks.</p>
<p>Please also note <b>webadmin</b> is only enabled with <b>Guice</b>. You can not use it when using James with <b>Spring</b>, as the required injections are not implemented.</p>
<p>In case of any error, the system will return an error message which is json format like this:</p>

<div class="source">
<div class="source">
<pre>{
    statusCode: &lt;error_code&gt;,
    type: &lt;error_type&gt;,
    message: &lt;the_error_message&gt;
    cause: &lt;the_detail_message_from_throwable&gt;
}
</pre></div></div>
<p>Also be aware that, in case things go wrong, all endpoints might return a 500 internal error (with a JSON body formatted as exposed above). To avoid information duplication, this is ommited on endpoint specific documentation.</p>
<div class="section">
<h2><a name="Navigation_menu"></a>Navigation menu</h2>

<ul>
  
<li><a href="#HealthCheck">HealthCheck</a></li>
  
<li><a href="#Administrating_domains">Administrating domains</a></li>
  
<li><a href="#Administrating_users">Administrating users</a></li>
  
<li><a href="#Administrating_user_mailboxes">Administrating user mailboxes</a></li>
  
<li><a href="#Administrating_quotas_by_users">Administrating quotas by users</a></li>
  
<li><a href="#Administrating_quotas_by_domains">Administrating quotas by domains</a></li>
  
<li><a href="#Administrating_global_quotas">Administrating global quotas</a></li>
  
<li><a href="#Cassandra_schema_upgrades">Cassandra Schema upgrades</a></li>
  
<li><a href="#Correcting_ghost_mailbox">Correcting ghost mailbox</a></li>
  
<li><a href="#Creating_address_group">Creating address group</a></li>
  
<li><a href="#Creating_address_forwards">Creating address forwards</a></li>
  
<li><a href="#Creating_address_aliases">Creating address aliases</a></li>
  
<li><a href="#Administrating_mail_repositories">Administrating mail repositories</a></li>
  
<li><a href="#Administrating_mail_queues">Administrating mail queues</a></li>
  
<li><a href="#Administrating_dlp_configuration">Administrating DLP Configuration</a></li>
  
<li><a href="#Administrating_Sieve_quotas">Administrating Sieve quotas</a></li>
  
<li><a href="#ReIndexing">ReIndexing</a></li>
  
<li><a href="#Task_management">Task management</a></li>
</ul></div>
<div class="section">
<h2><a name="HealthCheck"></a>HealthCheck</h2>

<ul>
  
<li><a href="#Check_all_components">Check all components</a></li>
  
<li><a href="#Check_single_component">Check single component</a></li>
  
<li><a href="#List_all_health_checks">List all health checks</a></li>
</ul>
<div class="section">
<h3><a name="Check_all_components"></a>Check all components</h3>
<p>This endpoint is simple for now and is just returning the http status code corresponding to the state of checks (see below). The user has to check in the logs in order to have more information about failing checks.</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/healthcheck
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: All checks have answered with a Healthy status</li>
  
<li>500: At least one check have answered with a Unhealthy or Degraded status</li>
</ul></div>
<div class="section">
<h3><a name="Check_single_component"></a>Check single component</h3>
<p>Performs a health check for the given component. The component is referenced by its URL encoded name.</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/healthcheck/checks/Cassandra%20Backend
</pre></div></div>
<p>Will return the component&#x2019;s name, the component&#x2019;s escaped name, the health status and a cause.</p>

<div class="source">
<div class="source">
<pre>{
  &quot;componentName&quot;: &quot;Cassandra Backend&quot;,
  &quot;escapedComponentName&quot;: &quot;Cassandra%20Backend&quot;,
  &quot;status&quot;: &quot;HEALTHY&quot;
  &quot;cause&quot;: null
}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The check has answered with a Healthy status.</li>
  
<li>404: A component with the given name was not found.</li>
  
<li>500: The check has anwered with a Unhealthy or Degraded status.</li>
</ul></div>
<div class="section">
<h3><a name="List_all_health_checks"></a>List all health checks</h3>
<p>This endpoint lists all the available health checks.</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/healthcheck/checks
</pre></div></div>
<p>Will return the list of all available health checks.</p>

<div class="source">
<div class="source">
<pre>[
    {
        &quot;componentName&quot;: &quot;Cassandra Backend&quot;,
        &quot;escapedComponentName&quot;: &quot;Cassandra%20Backend&quot;
    }
]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: List of available health checks</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_domains"></a>Administrating domains</h2>

<ul>
  
<li><a href="#Create_a_domain">Create a domain</a></li>
  
<li><a href="#Delete_a_domain">Delete a domain</a></li>
  
<li><a href="#Test_if_a_domain_exists">Test if a domain exists</a></li>
  
<li><a href="#Get_the_list_of_domains">Get the list of domains</a></li>
</ul>
<div class="section">
<h3><a name="Create_a_domain"></a>Create a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/domains/domainToBeCreated
</pre></div></div>
<p>Resource name domainToBeCreated:</p>

<ul>
  
<li>can not be null or empty</li>
  
<li>can not contain &#x2018;@&#x2019;</li>
  
<li>can not be more than 255 characters</li>
  
<li>can not contain &#x2018;/&#x2019;</li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>204: The domain was successfully added</li>
  
<li>400: The domain name is invalid</li>
</ul></div>
<div class="section">
<h3><a name="Delete_a_domain"></a>Delete a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/domains/domainToBeDeleted
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The domain was successfully removed</li>
</ul></div>
<div class="section">
<h3><a name="Test_if_a_domain_exists"></a>Test if a domain exists</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/domains/domainName
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The domain exists</li>
  
<li>404: The domain does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Get_the_list_of_domains"></a>Get the list of domains</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/domains
</pre></div></div>
<p>Possible response:</p>

<div class="source">
<div class="source">
<pre>{&quot;domains&quot;:[&quot;domain1&quot;, &quot;domain2&quot;]}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The domain list was successfully retrieved</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_users"></a>Administrating users</h2>

<ul>
  
<li><a href="#Create_a_user">Create a user</a></li>
  
<li><a href="#Updating_a_user_password">Updating a user password</a></li>
  
<li><a href="#Deleting_a_user">Deleting a domain</a></li>
  
<li><a href="#Retrieving_the_user_list">Retrieving the user list</a></li>
</ul>
<div class="section">
<h3><a name="Create_a_user"></a>Create a user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/users/usernameToBeUsed -d '{&quot;password&quot;:&quot;passwordToBeUsed&quot;}'
</pre></div></div>
<p>Resource name usernameToBeUsed:</p>

<ul>
  
<li>can not be null or empty</li>
  
<li>can not be more than 255 characters</li>
  
<li>can not contain &#x2018;/&#x2019;</li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>204: The user was successfully created</li>
  
<li>400: The user name or the payload is invalid</li>
  
<li>409: Conflict: A concurrent modification make that query to fail</li>
</ul>
<p>Note: if the user is already, its password will be updated.</p></div>
<div class="section">
<h3><a name="Updating_a_user_password"></a>Updating a user password</h3>
<p>Same than Create, but a user need to exist.</p>
<p>If the user do not exist, then it will be created.</p></div>
<div class="section">
<h3><a name="Deleting_a_user"></a>Deleting a user</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/userToBeDeleted
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The user was successfully deleted</li>
</ul></div>
<div class="section">
<h3><a name="Retrieving_the_user_list"></a>Retrieving the user list</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[{&quot;username&quot;:&quot;username@domain-jmapauthentication.tld&quot;},{&quot;username&quot;:&quot;username@domain.tld&quot;}]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The user name list was successfully retrieved</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_user_mailboxes"></a>Administrating user mailboxes</h2>

<ul>
  
<li><a href="#Creating_a_mailbox">Creating a mailbox</a></li>
  
<li><a href="#Deleting_a_mailbox_and_its_children">Deleting a mailbox and its children</a></li>
  
<li><a href="#Testing_existence_of_a_mailbox">Testing existence of a mailbox</a></li>
  
<li><a href="#Listing_user_mailboxes">Listing user mailboxes</a></li>
  
<li><a href="#Deleting_user_mailboxes">Deleting_user_mailboxes</a></li>
</ul>
<div class="section">
<h3><a name="Creating_a_mailbox"></a>Creating a mailbox</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty, nor contain # &amp; % * characters.</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox now exists on the server</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist</li>
  
<li>500: Internal error</li>
</ul>
<p>To create nested mailboxes, for instance a work mailbox inside the INBOX mailbox, people should use the . separator. The sample query is:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes/INBOX.work
</pre></div></div></div>
<div class="section">
<h3><a name="Deleting_a_mailbox_and_its_children"></a>Deleting a mailbox and its children</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox now does not exist on the server</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Testing_existence_of_a_mailbox"></a>Testing existence of a mailbox</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox exists</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist, the mailbox does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Listing_user_mailboxes"></a>Listing user mailboxes</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users/usernameToBeUsed/mailboxes
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[{&quot;mailboxName&quot;:&quot;INBOX&quot;},{&quot;mailboxName&quot;:&quot;outbox&quot;}]
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>200: The mailboxes list was successfully retrieved</li>
  
<li>404: The user name does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_user_mailboxes"></a>Deleting user mailboxes</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>204: The user do not have mailboxes anymore</li>
  
<li>404: The user name does not exist</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_quotas_by_users"></a>Administrating quotas by users</h2>

<ul>
  
<li><a href="#Getting_the_quota_for_a_user">Getting the quota for a user</a></li>
  
<li><a href="#Updating_the_quota_for_a_user">Updating the quota for a user</a></li>
  
<li><a href="#Getting_the_quota_count_for_a_user">Getting the quota count for a user</a></li>
  
<li><a href="#Updating_the_quota_count_for_a_user">Updating the quota count for a user</a></li>
  
<li><a href="#Deleting_the_quota_count_for_a_user">Deleting the quota count for a user</a></li>
  
<li><a href="#Getting_the_quota_size_for_a_user">Getting the quota size for a user</a></li>
  
<li><a href="#Updating_the_quota_size_for_a_user">Updating the quota size for a user</a></li>
  
<li><a href="#Deleting_the_quota_size_for_a_user">Deleting the quota size for a user</a></li>
  
<li><a href="#Searching_user_by_quota_ratio">Searching user by quota ratio</a></li>
</ul>
<div class="section">
<h3><a name="Getting_the_quota_for_a_user"></a>Getting the quota for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/users/usernameToBeUsed
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The answer is the details of the quota of that user.</p>

<div class="source">
<div class="source">
<pre>{
  &quot;global&quot;: {
    &quot;count&quot;:252,
    &quot;size&quot;:242
  },
  &quot;domain&quot;: {
    &quot;count&quot;:152,
    &quot;size&quot;:142
  },
  &quot;user&quot;: {
    &quot;count&quot;:52,
    &quot;size&quot;:42
  },
  &quot;computed&quot;: {
    &quot;count&quot;:52,
    &quot;size&quot;:42
  },
  &quot;occupation&quot;: {
    &quot;size&quot;:1000,
    &quot;count&quot;:10000,
    &quot;ratio&quot;: {
      &quot;size&quot;:0.8,
      &quot;count&quot;:0.6,
      &quot;max&quot;:0.8
    }
  }
}
</pre></div></div>

<ul>
  
<li>The <tt>global</tt> entry represent the quota limit allowed on this James server.</li>
  
<li>The <tt>domain</tt> entry represent the quota limit allowed for the user of that domain.</li>
  
<li>The <tt>user</tt> entry represent the quota limit allowed for this specific user.</li>
  
<li>The <tt>computed</tt> entry represent the quota limit applied for this user, resolved from the upper values.</li>
  
<li>The <tt>occupation</tt> entry represent the occupation of the quota for this user. This includes used count and size as well as occupation ratio (used / limit).</li>
</ul>
<p>Note that <tt>quota</tt> object can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The user&#x2019;s quota was successfully retrieved</li>
  
<li>404: The user does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_for_a_user"></a>Updating the quota for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/users/usernameToBeUsed
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The body can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_quota_count_for_a_user"></a>Getting the quota count for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/users/usernameToBeUsed/count
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The user&#x2019;s quota was successfully retrieved</li>
  
<li>404: The user does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_count_for_a_user"></a>Updating the quota count for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/users/usernameToBeUsed/count
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_quota_count_for_a_user"></a>Deleting the quota count for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/users/usernameToBeUsed/count
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_quota_size_for_a_user"></a>Getting the quota size for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/users/usernameToBeUsed/size
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The user&#x2019;s quota was successfully retrieved</li>
  
<li>404: The user does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_size_for_a_user"></a>Updating the quota size for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/users/usernameToBeUsed/size
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_quota_size_for_a_user"></a>Deleting the quota size for a user</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/users/usernameToBeUsed/size
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Searching_user_by_quota_ratio"></a>Searching user by quota ratio</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/users?minOccupationRatio=0.8&amp;maxOccupationRatio=0.99&amp;limit=100&amp;offset=200&amp;domain=oppen-paas.org
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>[
  {
    &quot;username&quot;:&quot;user@open-paas.org&quot;,
    &quot;detail&quot;: {
      &quot;global&quot;: {
        &quot;count&quot;:252,
        &quot;size&quot;:242
      },
      &quot;domain&quot;: {
        &quot;count&quot;:152,
        &quot;size&quot;:142
      },
      &quot;user&quot;: {
        &quot;count&quot;:52,
        &quot;size&quot;:42
      },
      &quot;computed&quot;: {
        &quot;count&quot;:52,
        &quot;size&quot;:42
      },
      &quot;occupation&quot;: {
        &quot;size&quot;:1000,
        &quot;count&quot;:10000,
        &quot;ratio&quot;: {
          &quot;size&quot;:0.8,
          &quot;count&quot;:0.6,
          &quot;max&quot;:0.8
        }
      }
    }
  },
  ...
]
</pre></div></div>
<p>Where:</p>

<ul>
  
<li><b>minOccupationRatio</b> is a query parameter determining the minimum occupation ratio of users to be returned.</li>
  
<li><b>maxOccupationRatio</b> is a query parameter determining the maximum occupation ratio of users to be returned.</li>
  
<li><b>domain</b> is a query parameter determining the domain of users to be returned.</li>
  
<li><b>limit</b> is a query parameter determining the maximum number of users to be returned.</li>
  
<li><b>offset</b> is a query parameter determining the number of users to skip.</li>
</ul>
<p>Please note that users are alphabetically ordered on username.</p>
<p>The response is a list of usernames, with attached quota details as defined <a href="#getting-the-quota-for-a-user">here</a>.</p>
<p>Response codes:</p>

<ul>
  
<li>200: List of users had successfully been returned.</li>
  
<li>400: Validation issues with parameters</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_quotas_by_domains"></a>Administrating quotas by domains</h2>

<ul>
  
<li><a href="#Getting_the_quota_for_a_domain">Getting the quota for a domain</a></li>
  
<li><a href="#Updating_the_quota_for_a_domain">Updating the quota for a domain</a></li>
  
<li><a href="#Getting_the_quota_count_for_a_domain">Getting the quota count for a domain</a></li>
  
<li><a href="#Updating_the_quota_count_for_a_domain">Updating the quota count for a domain</a></li>
  
<li><a href="#Deleting_the_quota_count_for_a_domain">Deleting the quota count for a domain</a></li>
  
<li><a href="#Getting_the_quota_size_for_a_domain">Getting the quota size for a domain</a></li>
  
<li><a href="#Updating_the_quota_size_for_a_domain">Updating the quota size for a domain</a></li>
  
<li><a href="#Deleting_the_quota_size_for_a_domain">Deleting the quota size for a domain</a></li>
</ul>
<div class="section">
<h3><a name="Getting_the_quota_for_a_domain"></a>Getting the quota for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/domains/domainToBeUsed
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain. For example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/domains/james.org
</pre></div></div>
<p>The answer will detail the default quota applied to users belonging to that domain:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;global&quot;: {
    &quot;count&quot;:252,
    &quot;size&quot;:null
  },
  &quot;domain&quot;: {
    &quot;count&quot;:null,
    &quot;size&quot;:142
  },
  &quot;computed&quot;: {
    &quot;count&quot;:252,
    &quot;size&quot;:142
  }
}
</pre></div></div>

<ul>
  
<li>The <tt>global</tt> entry represents the quota limit defined on this James server by default.</li>
  
<li>The <tt>domain</tt> entry represents the quota limit allowed for the user of that domain by default.</li>
  
<li>The <tt>computed</tt> entry represents the quota limit applied for the users of that domain, by default, resolved from the upper values.</li>
</ul>
<p>Note that <tt>quota</tt> object can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The domain&#x2019;s quota was successfully retrieved</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_for_a_domain"></a>Updating the quota for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/domains/domainToBeUsed
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>The body can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_quota_count_for_a_domain"></a>Getting the quota count for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/domains/domainToBeUsed/count
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The domain&#x2019;s quota was successfully retrieved</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
  
<li>500: Internal error while accessing the domain&#x2019;s quota</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_count_for_a_domain"></a>Updating the quota count for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/domains/domainToBeUsed/count
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_quota_count_for_a_domain"></a>Deleting the quota count for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/domains/domainToBeUsed/count
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
  
<li>500: Internal server error - Something went bad on the server side.</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_quota_size_for_a_domain"></a>Getting the quota size for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/domains/domainToBeUsed/size
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The domain&#x2019;s quota was successfully retrieved</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_quota_size_for_a_domain"></a>Updating the quota size for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/domains/domainToBeUsed/size
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The domain does not exist</li>
  
<li>405: Domain Quota configuration not supported when virtual hosting is desactivated.</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
  
<li>500: Internal server error - Something went bad on the server side.</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_quota_size_for_a_domain"></a>Deleting the quota size for a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/domains/domainToBeUsed/size
</pre></div></div>
<p>Resource name domainToBeUsed should be an existing domain.</p>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The domain does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
  
<li>500: Internal server error - Something went bad on the server side.</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_global_quotas"></a>Administrating global quotas</h2>

<ul>
  
<li><a href="#Getting_the_global_quota">Getting the global quota</a></li>
  
<li><a href="#Updating_global_quota">Updating global quota</a></li>
  
<li><a href="#Getting_the_global_quota_count">Getting the global quota count</a></li>
  
<li><a href="#Updating_the_global_quota_count">Updating the global quota count</a></li>
  
<li><a href="#Deleting_the_global_quota_count">Deleting the global quota count</a></li>
  
<li><a href="#Getting_the_global_quota_size">Getting the global quota size</a></li>
  
<li><a href="#Updating_the_global_quota_size">Updating the global quota size</a></li>
  
<li><a href="#Deleting_the_global_quota_size">Deleting the global quota size</a></li>
</ul>
<div class="section">
<h3><a name="Getting_the_global_quota"></a>Getting the global quota</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The answer is the details of the quota of that user.</p>

<div class="source">
<div class="source">
<pre>{
  &quot;count&quot;:252,
  &quot;size&quot;:242
}
</pre></div></div>
<p>Note that <tt>quota</tt> object can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The quota was successfully retrieved</li>
</ul></div>
<div class="section">
<h3><a name="Updating_global_quota"></a>Updating global quota</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota
</pre></div></div>
<p>The body can contain a fixed value, an empty value (null) or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}

{&quot;count&quot;:null,&quot;size&quot;:null}

{&quot;count&quot;:52,&quot;size&quot;:-1}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_global_quota_count"></a>Getting the global quota count</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/count
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The quota was successfully retrieved</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_global_quota_count"></a>Updating the global quota count</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/count
</pre></div></div>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_global_quota_count"></a>Deleting the global quota count</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/count
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>404: The user does not exist</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Getting_the_global_quota_size"></a>Getting the global quota size</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/size
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The quota was successfully retrieved</li>
</ul></div>
<div class="section">
<h3><a name="Updating_the_global_quota_size"></a>Updating the global quota size</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/size
</pre></div></div>
<p>The body can contain a fixed value or an unlimited value (-1):</p>

<div class="source">
<div class="source">
<pre>52
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_the_global_quota_size"></a>Deleting the global quota size</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/size
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The quota has been updated to unlimited value.</li>
  
<li>400: The body is not a positive integer neither an unlimited value (-1).</li>
  
<li>409: The requested restriction can&#x2019;t be enforced right now.</li>
</ul></div></div>
<div class="section">
<h2><a name="Cassandra_Schema_upgrades"></a>Cassandra Schema upgrades</h2>
<p>Cassandra upgrades implies the creation of a new table. Thus restarting James is needed, as new tables are created on restart.</p>
<p>Once done, we ship code that tries to read from new tables, and if not possible backs up to old tables. You can thus safely run without running additional migrations.</p>
<p>On the fly migration can be enabled. However, one might want to force the migration in a controlled fashion, and update automatically current schema version used (assess in the database old versions is no more used, as the corresponding tables are empty). Note that this process is safe: we ensure the service is not running concurrently on this James instance, that it does not bump version upon partial failures, that race condition in version upgrades will be idempotent, etc&#x2026;</p>
<p>These schema updates can be triggered by webadmin using the Cassandra backend.</p>
<p>Note that currently the progress can be tracked by logs.</p>

<ul>
  
<li><a href="#Retrieving_current_cassandra_schema_version">Retrieving current Cassandra schema version</a></li>
  
<li><a href="#Retrieving_latest_available_cassandra_schema_version">Retrieving latest available Cassandra schema version</a></li>
  
<li><a href="#Upgrading_to_a_specific_version">Upgrading to a specific version</a></li>
  
<li><a href="#Upgrading_to_the_latest_version">Upgrading to the latest version</a></li>
</ul>
<div class="section">
<h3><a name="Retrieving_current_Cassandra_schema_version"></a>Retrieving current Cassandra schema version</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/cassandra/version
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>2
</pre></div></div>
<p>Where the number corresponds to the current schema version of the database you are using.</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
</ul></div>
<div class="section">
<h3><a name="Retrieving_latest_available_Cassandra_schema_version"></a>Retrieving latest available Cassandra schema version</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/cassandra/version
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>3
</pre></div></div>
<p>Where the number corresponds to the latest available schema version of the database you are using. This means you can be migrating to this schema version.</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
</ul></div>
<div class="section">
<h3><a name="Upgrading_to_a_specific_version"></a>Upgrading to a specific version</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/version/upgrade -d '3'
</pre></div></div>
<p>Will schedule the run of the migrations you need to reach schema version 3. The <tt>taskId</tt> will allow you to monitor and manage this process.</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success. The scheduled task taskId is returned.</li>
  
<li>400: The version is invalid. The version should be a strictly positive number.</li>
  
<li>410: Error while planning this migration. This resource is gone away. Reason is mentionned in the body.</li>
</ul>
<p>Note that several calls to this endpoint will be run in a sequential pattern.</p>
<p>If the server restarts during the migration, the migration is silently aborted.</p>
<p>The scheduled task will have the following type <tt>CassandraMigration</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{&quot;toVersion&quot;:3}
</pre></div></div></div>
<div class="section">
<h3><a name="Upgrading_to_the_latest_version"></a>Upgrading to the latest version</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/version/upgrade/latest
</pre></div></div>
<p>Will schedule the run of the migrations you need to reach the latest schema version. The <tt>taskId</tt> will allow you to monitor and manage this process.</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success. The scheduled task taskId is returned.</li>
  
<li>410: Error while planning this migration. This resource is gone away. Reason is mentionned in the body.</li>
</ul>
<p>Note that several calls to this endpoint will be run in a sequential pattern.</p>
<p>If the server restarts during the migration, the migration is silently aborted.</p>
<p>The scheduled task will have the following type <tt>CassandraMigration</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{&quot;toVersion&quot;:2}
</pre></div></div></div></div>
<div class="section">
<h2><a name="Correcting_ghost_mailbox"></a>Correcting ghost mailbox</h2>
<p>This is a temporary workaround for the <b>Ghost mailbox</b> bug encountered using the Cassandra backend, as described in MAILBOX-322.</p>
<p>You can use the mailbox merging feature in order to merge the old &#x201c;ghosted&#x201d; mailbox with the new one.</p>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/mailbox/merging -d '{&quot;mergeOrigin&quot;:&quot;id1&quot;, &quot;mergeDestination&quot;:&quot;id2&quot;}'
</pre></div></div>
<p>Will scedule a task for :</p>

<ul>
  
<li>Delete references to <tt>id1</tt> mailbox</li>
  
<li>Move it&#x2019;s messages into <tt>id2</tt> mailbox</li>
  
<li>Union the rights of both mailboxes</li>
</ul>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Unable to parse the body.</li>
</ul>
<p>The scheduled task will have the following type <tt>mailboxMerging</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;oldMailboxId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;,
  &quot;newMailboxId&quot;:&quot;4555159-52ae-895f-ccb7-586a4412fb50&quot;,
  &quot;totalMessageCount&quot;: 1,
  &quot;messageMovedCount&quot;: 1,
  &quot;messageFailedCount&quot;: 0
}
</pre></div></div></div>
<div class="section">
<h2><a name="Creating_address_group"></a>Creating address group</h2>
<p>You can use <b>webadmin</b> to define address groups.</p>
<p>When a specific email is sent to the group mail address, every group member will receive it.</p>
<p>Note that the group mail address is virtual: it does not correspond to an existing user.</p>
<p>This feature uses <a href="/server/config-recipientrewritetable.html">Recipients rewrite table</a> and requires the <a class="externalLink" href="https://github.com/apache/james-project/blob/master/server/mailet/mailets/src/main/java/org/apache/james/transport/mailets/RecipientRewriteTable.java">RecipientRewriteTable mailet</a> to be configured.</p>
<p>Note that email addresses are restricted to ASCII character set. Mail addresses not matching this criteria will be rejected.</p>

<ul>
  
<li><a href="#Listing_groups">Listing groups</a></li>
  
<li><a href="#Listing_members_of_a_group">Listing members of a group</a></li>
  
<li><a href="#Adding_a_group_member">Adding a group member</a></li>
  
<li><a href="#Removing_a_group_member">Removing a group member</a></li>
</ul>
<div class="section">
<h3><a name="Listing_groups"></a>Listing groups</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/groups
</pre></div></div>
<p>Will return the groups as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;group1@domain.com&quot;, &quot;group2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
</ul></div>
<div class="section">
<h3><a name="Listing_members_of_a_group"></a>Listing members of a group</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/groups/group@domain.com
</pre></div></div>
<p>Will return the group members as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;member1@domain.com&quot;, &quot;member2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Group structure is not valid</li>
  
<li>404: The group does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Adding_a_group_member"></a>Adding a group member</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/address/groups/group@domain.com/member@domain.com
</pre></div></div>
<p>Will add <a class="externalLink" href="mailto:member@domain.com">member@domain.com</a> to <a class="externalLink" href="mailto:group@domain.com">group@domain.com</a>, creating the group if needed</p>
<p>Response codes:</p>

<ul>
  
<li>204: Success</li>
  
<li>400: Group structure or member is not valid</li>
  
<li>403: Server does not own the requested domain</li>
  
<li>409: Requested group address is already used for another purpose</li>
</ul></div>
<div class="section">
<h3><a name="Removing_a_group_member"></a>Removing a group member</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/address/groups/group@domain.com/member@domain.com
</pre></div></div>
<p>Will remove <a class="externalLink" href="mailto:member@domain.com">member@domain.com</a> from <a class="externalLink" href="mailto:group@domain.com">group@domain.com</a>, removing the group if group is empty after deletion</p>
<p>Response codes:</p>

<ul>
  
<li>204: Success</li>
  
<li>400: Group structure or member is not valid</li>
</ul></div></div>
<div class="section">
<h2><a name="Creating_address_forwards"></a>Creating address forwards</h2>
<p>You can use <b>webadmin</b> to define address forwards.</p>
<p>When a specific email is sent to the base mail address, every forward destination addresses will receive it.</p>
<p>Please note that the base address can be optionaly part of the forward destination. In that case, the base recipient also receive a copy of the mail. Otherwise he is ommitted.</p>
<p>Forwards can be defined for existing users. It then defers from &#x201c;groups&#x201d;.</p>
<p>This feature uses <a href="/server/config-recipientrewritetable.html">Recipients rewrite table</a> and requires the <a class="externalLink" href="https://github.com/apache/james-project/blob/master/server/mailet/mailets/src/main/java/org/apache/james/transport/mailets/RecipientRewriteTable.java">RecipientRewriteTable mailet</a> to be configured.</p>
<p>Note that email addresses are restricted to ASCII character set. Mail addresses not matching this criteria will be rejected.</p>

<ul>
  
<li><a href="#Listing_forwards">Listing Forwards</a></li>
  
<li><a href="#Listing_destinations_in_a_forward">Listing destinations in a forward</a></li>
  
<li><a href="#Adding_a_new_destination_to_a_forward">Adding a new destination to a forward</a></li>
  
<li><a href="#Removing_a_destination_of_a_forward">Removing a destination of a forward</a></li>
</ul>
<div class="section">
<h3><a name="Listing_Forwards"></a>Listing Forwards</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/forwards
</pre></div></div>
<p>Will return the users having forwards configured as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;user1@domain.com&quot;, &quot;user2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
</ul></div>
<div class="section">
<h3><a name="Listing_destinations_in_a_forward"></a>Listing destinations in a forward</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/forwards/user@domain.com
</pre></div></div>
<p>Will return the destination addresses of this forward as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[
  {&quot;mailAddres&quot;:&quot;destination1@domain.com&quot;},
  {&quot;mailAddres&quot;:&quot;destination2@domain.com&quot;}
]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Forward structure is not valid</li>
  
<li>404: The given user don&#x2019;t have forwards or does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Adding_a_new_destination_to_a_forward"></a>Adding a new destination to a forward</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/address/forwards/user@domain.com/targets/destination@domain.com
</pre></div></div>
<p>Will add <a class="externalLink" href="mailto:destination@domain.com">destination@domain.com</a> to <a class="externalLink" href="mailto:user@domain.com">user@domain.com</a>, creating the forward if needed</p>
<p>Response codes:</p>

<ul>
  
<li>204: Success</li>
  
<li>400: Forward structure or member is not valid</li>
  
<li>403: Server does not own the requested domain</li>
  
<li>404: Requested forward address does not match an existing user</li>
</ul></div>
<div class="section">
<h3><a name="Removing_a_destination_of_a_forward"></a>Removing a destination of a forward</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/address/forwards/user@domain.com/targets/destination@domain.com
</pre></div></div>
<p>Will remove <a class="externalLink" href="mailto:destination@domain.com">destination@domain.com</a> from <a class="externalLink" href="mailto:user@domain.com">user@domain.com</a>, removing the forward if forward is empty after deletion</p>
<p>Response codes:</p>

<ul>
  
<li>204: Success</li>
  
<li>400: Forward structure or member is not valid</li>
</ul></div></div>
<div class="section">
<h2><a name="Creating_address_aliases"></a>Creating address aliases</h2>
<p>You can use <b>webadmin</b> to define aliases for an user.</p>
<p>When a specific email is sent to the alias address, the destination address of the alias will receive it.</p>
<p>Aliases can be defined for existing users.</p>
<p>This feature uses <a href="/server/config-recipientrewritetable.html">Recipients rewrite table</a> and requires the <a class="externalLink" href="https://github.com/apache/james-project/blob/master/server/mailet/mailets/src/main/java/org/apache/james/transport/mailets/RecipientRewriteTable.java">RecipientRewriteTable mailet</a> to be configured.</p>
<p>Note that email addresses are restricted to ASCII character set. Mail addresses not matching this criteria will be rejected.</p>

<ul>
  
<li><a href="#Listing_users_with_aliases">Listing users with aliases</a></li>
  
<li><a href="#Listing_alias_sources_of_an_user">Listing alias sources of an user</a></li>
  
<li><a href="#Adding_a_new_alias_to_an_user">Adding a new alias to an user</a></li>
  
<li><a href="#Removing_an_alias_of_an_user">Removing an alias of an user</a></li>
</ul>
<div class="section">
<h3><a name="Listing_users_with_aliases"></a>Listing users with aliases</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/aliases
</pre></div></div>
<p>Will return the users having aliases configured as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;user1@domain.com&quot;, &quot;user2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
</ul></div>
<div class="section">
<h3><a name="Listing_alias_sources_of_an_user"></a>Listing alias sources of an user</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/aliases/user@domain.com
</pre></div></div>
<p>Will return the aliases of this user as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[
  {&quot;source&quot;:&quot;alias1@domain.com&quot;},
  {&quot;source&quot;:&quot;alias2@domain.com&quot;}
]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Alias structure is not valid</li>
</ul></div>
<div class="section">
<h3><a name="Adding_a_new_alias_to_an_user"></a>Adding a new alias to an user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/address/aliases/user@domain.com/sources/alias@domain.com
</pre></div></div>
<p>Will add <a class="externalLink" href="mailto:alias@domain.com">alias@domain.com</a> to <a class="externalLink" href="mailto:user@domain.com">user@domain.com</a>, creating the alias if needed</p>
<p>Response codes:</p>

<ul>
  
<li>204: OK</li>
  
<li>400: Alias structure or member is not valid</li>
  
<li>400: The alias source exists as an user already</li>
  
<li>400: Source and destination can&#x2019;t be the same!</li>
</ul></div>
<div class="section">
<h3><a name="Removing_an_alias_of_an_user"></a>Removing an alias of an user</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/address/aliases/user@domain.com/sources/alias@domain.com
</pre></div></div>
<p>Will remove <a class="externalLink" href="mailto:alias@domain.com">alias@domain.com</a> from <a class="externalLink" href="mailto:user@domain.com">user@domain.com</a>, removing the alias if needed</p>
<p>Response codes:</p>

<ul>
  
<li>204: OK</li>
  
<li>400: Alias structure or member is not valid</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_mail_repositories"></a>Administrating mail repositories</h2>

<ul>
  
<li><a href="#Create_a_mail_repository">Create a mail repository</a></li>
  
<li><a href="#Listing_mail_repositories">Listing mail repositories</a></li>
  
<li><a href="#Getting_additional_information_for_a_mail_repository">Getting additional information for a mail repository</a></li>
  
<li><a href="#Listing_mails_contained_in_a_mail_repository">Listing mails contained in a mail repository</a></li>
  
<li><a href="#Reading_a_mail_details">Reading a mail details</a></li>
  
<li><a href="#Removing_a_mail_from_a_mail_repository">Removing a mail from a mail repository</a></li>
  
<li><a href="#Removing_all_mails_from_a_mail_repository">Removing all mails from a mail repository</a></li>
  
<li><a href="#Reprocessing_mails_from_a_mail_repository">Reprocessing mails from a mail repository</a></li>
  
<li><a href="#Reprocessing_a_specific_mail_from_a_mail_repository">Reprocessing a specific mail from a mail repository</a></li>
</ul>
<div class="section">
<h3><a name="Create_a_mail_repository"></a>Create a mail repository</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/mailRepositories/encodedPathOfTheRepository?protocol=someProtocol
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of the created mail repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/mailRepositories/mailRepo?protocol=file
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The repository is created</li>
</ul></div>
<div class="section">
<h3><a name="Listing_mail_repositories"></a>Listing mail repositories</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[
    {
        &quot;repository&quot;: &quot;var/mail/error/&quot;,
        &quot;path&quot;: &quot;var%2Fmail%2Ferror%2F&quot;
    },
    {
        &quot;repository&quot;: &quot;var/mail/relay-denied/&quot;,
        &quot;path&quot;: &quot;var%2Fmail%2Frelay-denied%2F&quot;
    },
    {
        &quot;repository&quot;: &quot;var/mail/spam/&quot;,
        &quot;path&quot;: &quot;var%2Fmail%2Fspam%2F&quot;
    },
    {
        &quot;repository&quot;: &quot;var/mail/address-error/&quot;,
        &quot;path&quot;: &quot;var%2Fmail%2Faddress-error%2F&quot;
    }
]
</pre></div></div>
<p>You can use <tt>id</tt>, the encoded URL of the repository, to access it in later requests.</p>
<p>Response codes:</p>

<ul>
  
<li>200: The list of mail repositories</li>
</ul></div>
<div class="section">
<h3><a name="Getting_additional_information_for_a_mail_repository"></a>Getting additional information for a mail repository</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/encodedPathOfTheRepository/
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>{
   &quot;repository&quot;: &quot;var/mail/error/&quot;,
   &quot;path&quot;: &quot;mail%2Ferror%2F&quot;,
   &quot;size&quot;: 243
}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Additonnal information for that repository</li>
  
<li>404: This repository can not be found</li>
</ul></div>
<div class="section">
<h3><a name="Listing_mails_contained_in_a_mail_repository"></a>Listing mails contained in a mail repository</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/encodedPathOfTheRepository/mails
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails
</pre></div></div>
<p>The answer will contains all mailKey contained in that repository.</p>

<div class="source">
<div class="source">
<pre>[
    &quot;mail-key-1&quot;,
    &quot;mail-key-2&quot;,
    &quot;mail-key-3&quot;
]
</pre></div></div>
<p>Note that this can be used to read mail details.</p>
<p>You can pass additional URL parameters to this call in order to limit the output:  - A limit: no more elements than the specified limit will be returned. This needs to be strictly positive. If no value is specified, no limit will be applied.  - An offset: allow to skip elements. This needs to be positive. Default value is zero.</p>
<p>Example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails?limit=100&amp;offset=500
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The list of mail keys contained in that mail repository</li>
  
<li>400: Invalid parameters</li>
  
<li>404: This repository can not be found</li>
</ul></div>
<div class="section">
<h3><a name="Readingdownloading_a_mail_details"></a>Reading/downloading a mail details</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/encodedPathOfTheRepository/mails/mailKey
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Resource name <tt>mailKey</tt> should be the key of a mail stored in that repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails/mail-key-1
</pre></div></div>
<p>If the Accept header in the request is &#x201c;application/json&#x201d;, then the response looks like:</p>

<div class="source">
<div class="source">
<pre>{
    &quot;name&quot;: &quot;mail-key-1&quot;,
    &quot;sender&quot;: &quot;sender@domain.com&quot;,
    &quot;recipients&quot;: [&quot;recipient1@domain.com&quot;, &quot;recipient2@domain.com&quot;],
    &quot;state&quot;: &quot;address-error&quot;,
    &quot;error&quot;: &quot;A small message explaining what happened to that mail...&quot;,
    &quot;remoteHost&quot;: &quot;111.222.333.444&quot;,
    &quot;remoteAddr&quot;: &quot;127.0.0.1&quot;,
    &quot;lastUpdated&quot;: null
}
</pre></div></div>
<p>If the Accept header in the request is &#x201c;message/rfc822&#x201d;, then the response will be the <i>eml</i> file itself.</p>
<p>Additional query parameter <tt>additionalFields</tt> add the existing informations to the response for the supported values:  - attributes  - headers  - textBody  - htmlBody  - messageSize  - perRecipientsHeaders</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailRepositories/file%3A%2F%2Fvar%2Fmail%2Ferror%2F/mails/mail-key-1?additionalFields=attributes,headers,textBody,htmlBody,messageSize,perRecipientsHeaders
</pre></div></div>
<p>Give the following kind of response:</p>

<div class="source">
<div class="source">
<pre>{
    &quot;name&quot;: &quot;mail-key-1&quot;,
    &quot;sender&quot;: &quot;sender@domain.com&quot;,
    &quot;recipients&quot;: [&quot;recipient1@domain.com&quot;, &quot;recipient2@domain.com&quot;],
    &quot;state&quot;: &quot;address-error&quot;,
    &quot;error&quot;: &quot;A small message explaining what happened to that mail...&quot;,
    &quot;remoteHost&quot;: &quot;111.222.333.444&quot;,
    &quot;remoteAddr&quot;: &quot;127.0.0.1&quot;,
    &quot;lastUpdated&quot;: null,
    &quot;attributes&quot;: {
      &quot;name2&quot;: &quot;value2&quot;,
      &quot;name1&quot;: &quot;value1&quot;
    },
    &quot;perRecipientsHeaders&quot;: {
      &quot;third@party&quot;: {
        &quot;headerName1&quot;: [
          &quot;value1&quot;,
          &quot;value2&quot;
        ],
        &quot;headerName2&quot;: [
          &quot;value3&quot;,
          &quot;value4&quot;
        ]
      }
    },
    &quot;headers&quot;: {
      &quot;headerName4&quot;: [
        &quot;value6&quot;,
        &quot;value7&quot;
      ],
      &quot;headerName3&quot;: [
        &quot;value5&quot;,
        &quot;value8&quot;
      ]
    },
    &quot;textBody&quot;: &quot;My body!!&quot;,
    &quot;htmlBody&quot;: &quot;My &lt;em&gt;body&lt;/em&gt;!!&quot;,
    &quot;messageSize&quot;: 42424242
}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Details of the mail</li>
  
<li>404: This repository or mail can not be found</li>
</ul></div>
<div class="section">
<h3><a name="Removing_a_mail_from_a_mail_repository"></a>Removing a mail from a mail repository</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailRepositories/encodedPathOfTheRepository/mails/mailKey
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Resource name <tt>mailKey</tt> should be the key of a mail stored in that repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails/mail-key-1
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: This mail no longer exists in this repository</li>
  
<li>404: This repository can not be found</li>
</ul></div>
<div class="section">
<h3><a name="Removing_all_mails_from_a_mail_repository"></a>Removing all mails from a mail repository</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailRepositories/encodedPathOfTheRepository/mails
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Example:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails
</pre></div></div>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>404: Could not find that mail repository</li>
</ul>
<p>The scheduled task will have the following type <tt>clearMailRepository</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;repositoryPath&quot;:&quot;var/mail/error/&quot;,
  &quot;initialCount&quot;: 243,
  &quot;remainingCount&quot;: 17
}
</pre></div></div></div>
<div class="section">
<h3><a name="Reprocessing_mails_from_a_mail_repository"></a>Reprocessing mails from a mail repository</h3>
<p>Sometime, you want to re-process emails stored in a mail repository. For instance, you can make a configuration error, or there can be a James bug that makes processing of some mails fail. Those mail will be stored in a mail repository. Once you solved the problem, you can reprocess them.</p>
<p>To reprocess mails from a repository:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/encodedPathOfTheRepository/mails?action=reprocess
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource path of an existing mail repository. Example:</p>
<p>For instance:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails?action=reprocess
</pre></div></div>
<p>Additional query paramaters are supported:  - <tt>queue</tt> allow you to target the mail queue you want to enqueue the mails in.  - <tt>processor</tt> allow you to overwrite the state of the reprocessing mails, and thus select the processors they will start their processing in.</p>
<p>For instance:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails?action=reprocess&amp;processor=transport&amp;queue=spool
</pre></div></div>
<p>Note that the <tt>action</tt> query parameter is compulsary and can only take value <tt>reprocess</tt>.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>404: Could not find that mail repository</li>
</ul>
<p>The scheduled task will have the following type <tt>reprocessingAllTask</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;repositoryPath&quot;:&quot;var/mail/error/&quot;,
  &quot;targetQueue&quot;:&quot;spool&quot;,
  &quot;targetProcessor&quot;:&quot;transport&quot;,
  &quot;initialCount&quot;: 243,
  &quot;remainingCount&quot;: 17
}
</pre></div></div></div>
<div class="section">
<h3><a name="Reprocessing_a_specific_mail_from_a_mail_repository"></a>Reprocessing a specific mail from a mail repository</h3>
<p>To reprocess a specific mail from a mail repository:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/encodedPathOfTheRepository/mails/mailKey?action=reprocess
</pre></div></div>
<p>Resource name <tt>encodedPathOfTheRepository</tt> should be the resource id of an existing mail repository. Resource name <tt>mailKey</tt> should be the key of a mail stored in that repository. Example:</p>
<p>For instance:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails/name1?action=reprocess
</pre></div></div>
<p>Additional query paramaters are supported:  - <tt>queue</tt> allow you to target the mail queue you want to enqueue the mails in.  - <tt>processor</tt> allow you to overwrite the state of the reprocessing mails, and thus select the processors they will start their processing in.</p>
<p>For instance:</p>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailRepositories/var%2Fmail%2Ferror%2F/mails/name1?action=reprocess&amp;processor=transport&amp;queue=spool
</pre></div></div>
<p>Note that the <tt>action</tt> query parameter is compulsary and can only take value <tt>reprocess</tt>.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>404: Could not find that mail repository</li>
</ul>
<p>The scheduled task will have the following type <tt>reprocessingOneTask</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;repositoryPath&quot;:&quot;var/mail/error/&quot;,
  &quot;targetQueue&quot;:&quot;spool&quot;,
  &quot;targetProcessor&quot;:&quot;transport&quot;,
  &quot;mailKey&quot;:&quot;name1&quot;
}
</pre></div></div></div></div>
<div class="section">
<h2><a name="Administrating_mail_queues"></a>Administrating mail queues</h2>

<ul>
  
<li><a href="#Listing_mail_queues">Listing mail queues</a></li>
  
<li><a href="#Getting_a_mail_queue_details">Getting a mail queue details</a></li>
  
<li><a href="#Listing_the_mails_of_a_mail_queue">Listing the mails of a mail queue</a></li>
  
<li><a href="#Deleting_mails_from_a_mail_queue">Deleting mails from a mail queue</a></li>
  
<li><a href="#Clearing_a_mail_queue">Clearing a mail queue</a></li>
  
<li><a href="#Flushing_mails_from_a_mail_queue">Flushing mails from a mail queue</a></li>
</ul>
<div class="section">
<h3><a name="Listing_mail_queues"></a>Listing mail queues</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailQueues
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[&quot;outgoing&quot;,&quot;spool&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The list of mail queues</li>
</ul></div>
<div class="section">
<h3><a name="Getting_a_mail_queue_details"></a>Getting a mail queue details</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailQueues/mailQueueName
</pre></div></div>
<p>Resource name mailQueueName is the name of a mail queue, this command will return the details of the given mail queue. For instance:</p>

<div class="source">
<div class="source">
<pre>{&quot;name&quot;:&quot;outgoing&quot;,&quot;size&quot;:0}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Mail queue is not valid</li>
  
<li>404: The mail queue does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Listing_the_mails_of_a_mail_queue"></a>Listing the mails of a mail queue</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailQueues/mailQueueName/mails
</pre></div></div>
<p>Additional URL query parameters:</p>

<ul>
  
<li><tt>limit</tt>: Maximum number of mails returned in a single call. Only strictly positive integer values are accepted. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/mailQueues/mailQueueName/mails?limit=100
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[{
  &quot;name&quot;: &quot;Mail1516976156284-8b3093b9-eebf-4c40-9c26-1450f4fcdc3c-to-test.com&quot;,
  &quot;sender&quot;: &quot;user@james.linagora.com&quot;,
  &quot;recipients&quot;: [&quot;someone@test.com&quot;],
  &quot;nextDelivery&quot;: &quot;1969-12-31T23:59:59.999Z&quot;
}]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Mail queue is not valid or limit is invalid</li>
  
<li>404: The mail queue does not exist</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_mails_from_a_mail_queue"></a>Deleting mails from a mail queue</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailQueues/mailQueueName/mails?sender=senderMailAddress
</pre></div></div>
<p>This request should have exactly one query parameter from the following list:</p>

<ul>
  
<li>sender: which is a mail address (i.e. <a class="externalLink" href="mailto:sender@james.org">sender@james.org</a>)</li>
  
<li>name: which is a string</li>
  
<li>recipient: which is a mail address (i.e. <a class="externalLink" href="mailto:recipient@james.org">recipient@james.org</a>)</li>
</ul>
<p>The mails from the given mail queue matching the query parameter will be deleted.</p>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Invalid request</li>
  
<li>404: The mail queue does not exist</li>
</ul>
<p>The scheduled task will have the following type <tt>deleteMailsFromMailQueue</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;mailQueueName&quot;:&quot;outgoing&quot;,
  &quot;initialCount&quot;:10,
  &quot;remainingCount&quot;: 5,
  &quot;sender&quot;: &quot;sender@james.org&quot;,
  &quot;name&quot;: &quot;Java Developer&quot;,
  &quot;recipient: &quot;recipient@james.org&quot;
}
</pre></div></div></div>
<div class="section">
<h3><a name="Clearing_a_mail_queue"></a>Clearing a mail queue</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/mailQueues/mailQueueName/mails
</pre></div></div>
<p>All mails from the given mail queue will be deleted.</p>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Invalid request</li>
  
<li>404: The mail queue does not exist</li>
</ul>
<p>The scheduled task will have the following type <tt>clearMailQueue</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;mailQueueName&quot;:&quot;outgoing&quot;,
  &quot;initialCount&quot;:10,
  &quot;remainingCount&quot;: 0
}
</pre></div></div></div>
<div class="section">
<h3><a name="Flushing_mails_from_a_mail_queue"></a>Flushing mails from a mail queue</h3>

<div class="source">
<div class="source">
<pre>curl -XPATCH http://ip:port/mailQueues/mailQueueName?delayed=true \
  -d '{&quot;delayed&quot;: false}'
</pre></div></div>
<p>This request should have the query parameter <i>delayed</i> set to <i>true</i>, in order to indicate only delayed mails are affected. The payload should set the <tt>delayed</tt> field to false inorder to remove the delay. This is the only supported combination, and it performs a flush.</p>
<p>The mails delayed in the given mail queue will be flushed.</p>
<p>Response codes:</p>

<ul>
  
<li>204: Success (No content)</li>
  
<li>400: Invalid request</li>
  
<li>404: The mail queue does not exist</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_DLP_Configuration"></a>Administrating DLP Configuration</h2>
<p>DLP (stands for Data Leak Prevention) is supported by James. A DLP matcher will, on incoming emails, execute regular expressions on email sender, recipients or content, in order to report suspicious emails to an administrator. WebAdmin can be used to manage these DLP rules on a per <tt>senderDomain</tt> basis.</p>
<p><tt>senderDomain</tt> is domain of the sender of incoming emails, for example: <tt>apache.org</tt>, <tt>james.org</tt>,&#x2026; Each <tt>senderDomain</tt> correspond to a distinct DLP configuration.</p>

<ul>
  
<li><a href="List_dlp_configuration_by_sender_domain">List DLP configuration by sender domain</a></li>
  
<li><a href="Store_dlp_configuration_by_sender_domain">Store DLP configuration by sender domain</a></li>
  
<li><a href="Remove_dlp_configuration_by_sender_domain">Remove DLP configuration by sender domain</a></li>
  
<li><a href="Fetch_a_dlp_configuration_item_by_sender_domain_and_rule_id">Fetch a DLP configuration item by sender domain and rule id</a></li>
</ul>
<div class="section">
<h3><a name="List_DLP_configuration_by_sender_domain"></a>List DLP configuration by sender domain</h3>
<p>Retrieve a DLP configuration for corresponding <tt>senderDomain</tt>, a configuration contains list of configuration items</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/dlp/rules/senderDomain
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: A list of dlp configuration items is returned</li>
  
<li>400: Invalid senderDomain or payload in request</li>
  
<li>404: The domain does not exist.</li>
</ul>
<p>This is an example of returned body. The rules field is a list of rules as described below.</p>

<div class="source">
<div class="source">
<pre>{&quot;rules : [
  {
    &quot;id&quot;: &quot;1&quot;,
    &quot;expression&quot;: &quot;james.org&quot;,
    &quot;explanation&quot;: &quot;Find senders or recipients containing james[any char]org&quot;,
    &quot;targetsSender&quot;: true,
    &quot;targetsRecipients&quot;: true,
    &quot;targetsContent&quot;: false
  },
  {
    &quot;id&quot;: &quot;2&quot;,
    &quot;expression&quot;: &quot;Find senders containing apache[any char]org&quot;,
    &quot;explanation&quot;: &quot;apache.org&quot;,
    &quot;targetsSender&quot;: true,
    &quot;targetsRecipients&quot;: false,
    &quot;targetsContent&quot;: false
  }
]}
</pre></div></div></div>
<div class="section">
<h3><a name="Store_DLP_configuration_by_sender_domain"></a>Store DLP configuration by sender domain</h3>
<p>Store a DLP configuration for corresponding <tt>senderDomain</tt>, if any item of DLP configuration in the request is stored before, it will not be stored anymore</p>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/dlp/rules/senderDomain
</pre></div></div>
<p>The body can contain a list of DLP configuration items formed by those fields: - <tt>id</tt>(String) is mandatory, unique identifier of the configuration item - <tt>expression</tt>(String) is mandatory, regular expression to match contents of targets - <tt>explanation</tt>(String) is optional, description of the configuration item - <tt>targetsSender</tt>(boolean) is optional and defaults to false. If true, <tt>expression</tt> will be applied to Sender and to From headers of the mail - <tt>targetsContent</tt>(boolean) is optional and defaults to false. If true, <tt>expression</tt> will be applied to Subject headers and textual bodies (text/plain and text/html) of the mail - <tt>targetsRecipients</tt>(boolean) is optional and defaults to false. If true, <tt>expression</tt> will be applied to recipients of the mail</p>
<p>This is an example of returned body. The rules field is a list of rules as described below.</p>

<div class="source">
<div class="source">
<pre>{&quot;rules&quot;: [
  {
    &quot;id&quot;: &quot;1&quot;,
    &quot;expression&quot;: &quot;james.org&quot;,
    &quot;explanation&quot;: &quot;Find senders or recipients containing james[any char]org&quot;,
    &quot;targetsSender&quot;: true,
    &quot;targetsRecipients&quot;: true,
    &quot;targetsContent&quot;: false
  },
  {
    &quot;id&quot;: &quot;2&quot;,
    &quot;expression&quot;: &quot;Find senders containing apache[any char]org&quot;,
    &quot;explanation&quot;: &quot;apache.org&quot;,
    &quot;targetsSender&quot;: true,
    &quot;targetsRecipients&quot;: false,
    &quot;targetsContent&quot;: false
  }
]}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: List of dlp configuration items is stored</li>
  
<li>400: Invalid senderDomain or payload in request</li>
  
<li>404: The domain does not exist.</li>
</ul></div>
<div class="section">
<h3><a name="Remove_DLP_configuration_by_sender_domain"></a>Remove DLP configuration by sender domain</h3>
<p>Remove a DLP configuration for corresponding <tt>senderDomain</tt></p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/dlp/rules/senderDomain
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: DLP configuration is removed</li>
  
<li>400: Invalid senderDomain or payload in request</li>
  
<li>404: The domain does not exist.</li>
</ul></div>
<div class="section">
<h3><a name="Fetch_a_DLP_configuration_item_by_sender_domain_and_rule_id"></a>Fetch a DLP configuration item by sender domain and rule id</h3>
<p>Retrieve a DLP configuration rule for corresponding <tt>senderDomain</tt> and a <tt>ruleId</tt></p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/dlp/rules/senderDomain/rules/ruleId
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: A dlp configuration item is returned</li>
  
<li>400: Invalid senderDomain or payload in request</li>
  
<li>404: The domain and/or the rule does not exist.</li>
</ul>
<p>This is an example of returned body.</p>

<div class="source">
<div class="source">
<pre>{
  &quot;id&quot;: &quot;1&quot;,
  &quot;expression&quot;: &quot;james.org&quot;,
  &quot;explanation&quot;: &quot;Find senders or recipients containing james[any char]org&quot;,
  &quot;targetsSender&quot;: true,
  &quot;targetsRecipients&quot;: true,
  &quot;targetsContent&quot;: false
}
</pre></div></div></div></div>
<div class="section">
<h2><a name="Administrating_Sieve_quotas"></a>Administrating Sieve quotas</h2>
<p>Some limitations on space Users Sieve script can occupy can be configured by default, and overridden by user.</p>

<ul>
  
<li><a href="#Retieving_global_sieve_quota">Retrieving global sieve quota</a></li>
  
<li><a href="#Updating_global_sieve_quota">Updating global sieve quota</a></li>
  
<li><a href="#Removing_global_sieve_quota">Removing global sieve quota</a></li>
  
<li><a href="#Retieving_user_sieve_quota">Retieving user sieve quota</a></li>
  
<li><a href="#Updating_user_sieve_quota">Updating user sieve quota</a></li>
  
<li><a href="#Removing_user_sieve_quota">Removing user sieve quota</a></li>
</ul>
<div class="section">
<h3><a name="Retrieving_global_sieve_quota"></a>Retrieving global sieve quota</h3>
<p>This endpoints allows to retrieve the global Sieve quota, which will be users default:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/sieve/quota/default
</pre></div></div>
<p>Will return the bytes count allowed by user per default on this server.</p>

<div class="source">
<div class="source">
<pre>102400
</pre></div></div>
<p>Response codes:  - 200: Request is a success and the value is returned  - 204: No default quota is being configured</p></div>
<div class="section">
<h3><a name="Updating_global_sieve_quota"></a>Updating global sieve quota</h3>
<p>This endpoints allows to update the global Sieve quota, which will be users default:</p>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/sieve/quota/default
</pre></div></div>
<p>With the body being the bytes count allowed by user per default on this server.</p>

<div class="source">
<div class="source">
<pre>102400
</pre></div></div>
<p>Response codes:  - 204: Operation succeeded  - 400: Invalid payload</p></div>
<div class="section">
<h3><a name="Removing_global_sieve_quota"></a>Removing global sieve quota</h3>
<p>This endpoints allows to remove the global Sieve quota. There will no more be users default:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/sieve/quota/default
</pre></div></div>
<p>Response codes:  - 204: Operation succeeded</p></div>
<div class="section">
<h3><a name="Retrieving_user_sieve_quota"></a>Retrieving user sieve quota</h3>
<p>This endpoints allows to retrieve the Sieve quota of a user, which will be this users quota:</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/sieve/quota/users/user@domain.com
</pre></div></div>
<p>Will return the bytes count allowed for this user.</p>

<div class="source">
<div class="source">
<pre>102400
</pre></div></div>
<p>Response codes:  - 200: Request is a success and the value is returned  - 204: No quota is being configured for this user</p></div>
<div class="section">
<h3><a name="Updating_user_sieve_quota"></a>Updating user sieve quota</h3>
<p>This endpoints allows to update the Sieve quota of a user, which will be users default:</p>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/sieve/quota/users/user@domain.com
</pre></div></div>
<p>With the body being the bytes count allowed for this user on this server.</p>

<div class="source">
<div class="source">
<pre>102400
</pre></div></div>
<p>Response codes:  - 204: Operation succeeded  - 400: Invalid payload</p></div>
<div class="section">
<h3><a name="Removing_user_sieve_quota"></a>Removing user sieve quota</h3>
<p>This endpoints allows to remove the Sieve quota of a user. There will no more quota for this userrrrrrr:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/sieve/quota/users/user@domain.com
</pre></div></div>
<p>Response codes:  - 204: Operation succeeded</p></div></div>
<div class="section">
<h2><a name="ReIndexing"></a>ReIndexing</h2>

<ul>
  
<li><a href="#ReIndexing_all_mails">ReIndexing all mails</a></li>
  
<li><a href="#ReIndexing_a_user_mails">ReIndexing a user mails</a></li>
  
<li><a href="#ReIndexing_a_mailbox_mails">ReIndexing a mailbox mails</a></li>
  
<li><a href="#ReIndexing_a_single_mail">ReIndexing a single mail</a></li>
  
<li><a href="#ReIndexing_a_single_mail_by_messageId">ReIndexing a single mail by messageId</a></li>
</ul>
<p>Be also aware of the limits of these APIs:</p>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p>
<p>Warning: Canceling this task should be considered unsafe as it will leave the currently reIndexed mailbox as partially indexed.</p>
<p>Warning: While we have been trying to reduce the inconsistency window to a maximum (by keeping track of ongoing events), concurrent changes done during the reIndexing might be ignored.</p>
<div class="section">
<h3><a name="ReIndexing_all_mails"></a>ReIndexing all mails</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/mailboxes?task=reIndex
</pre></div></div>
<p>Will schedule a task for reIndexing all the mails stored on this James server.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Error in the request. Details can be found in the reported error.</li>
</ul>
<p>The scheduled task will have the following type <tt>FullReIndexing</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;successfullyReprocessMailCount&quot;:18,
  &quot;failedReprocessedMailCount&quot;: 1
}
</pre></div></div>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p>
<p>Warning: Canceling this task should be considered unsafe as it will leave the currently reIndexed mailbox as partially indexed.</p>
<p>Warning: While we have been trying to reduce the inconsistency window to a maximum (by keeping track of ongoing events), concurrent changes done during the reIndexing might be ignored.</p></div>
<div class="section">
<h3><a name="ReIndexing_a_user_mails"></a>ReIndexing a user mails</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/mailboxes?task=reIndex,user=bob%40domain.com
</pre></div></div>
<p>Will schedule a task for reIndexing all the mails in &#x201c;<a class="externalLink" href="mailto:bob@domain.com">bob@domain.com</a>&#x201d; mailboxes (encoded above).</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Error in the request. Details can be found in the reported error.</li>
</ul>
<p>The scheduled task will have the following type <tt>userReIndexing</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;user&quot;:&quot;bob@domain.com&quot;,
  &quot;successfullyReprocessMailCount&quot;:18,
  &quot;failedReprocessedMailCount&quot;: 1
}
</pre></div></div>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p>
<p>Warning: Canceling this task should be considered unsafe as it will leave the currently reIndexed mailbox as partially indexed.</p>
<p>Warning: While we have been trying to reduce the inconsistency window to a maximum (by keeping track of ongoing events), concurrent changes done during the reIndexing might be ignored.</p></div>
<div class="section">
<h3><a name="ReIndexing_a_mailbox_mails"></a>ReIndexing a mailbox mails</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/mailboxes/{mailboxId}?task=reIndex
</pre></div></div>
<p>Will schedule a task for reIndexing all the mails in one mailbox.</p>
<p>Note that &#x2018;mailboxId&#x2019; path parameter needs to be a (implementation dependent) valid mailboxId.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Error in the request. Details can be found in the reported error.</li>
</ul>
<p>The scheduled task will have the following type <tt>mailboxReIndexing</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;mailboxId&quot;:&quot;{mailboxId}&quot;,
  &quot;successfullyReprocessMailCount&quot;:18,
  &quot;failedReprocessedMailCount&quot;: 1
}
</pre></div></div>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p>
<p>Warning: Canceling this task should be considered unsafe as it will leave the currently reIndexed mailbox as partially indexed.</p>
<p>Warning: While we have been trying to reduce the inconsistency window to a maximum (by keeping track of ongoing events), concurrent changes done during the reIndexing might be ignored.</p></div>
<div class="section">
<h3><a name="ReIndexing_a_single_mail"></a>ReIndexing a single mail</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/mailboxes/{mailboxId}/uid/36?task=reIndex
</pre></div></div>
<p>Will schedule a task for reIndexing a single email.</p>
<p>Note that &#x2018;mailboxId&#x2019; path parameter needs to be a (implementation dependent) valid mailboxId.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Error in the request. Details can be found in the reported error.</li>
</ul>
<p>The scheduled task will have the following type <tt>messageReIndexing</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;mailboxId&quot;:&quot;{mailboxId}&quot;,
  &quot;uid&quot;:18
}
</pre></div></div>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p>
<p>Warning: Canceling this task should be considered unsafe as it will leave the currently reIndexed mailbox as partially indexed.</p></div>
<div class="section">
<h3><a name="ReIndexing_a_single_mail_by_messageId"></a>ReIndexing a single mail by messageId</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/messages/{messageId}?task=reIndex
</pre></div></div>
<p>Will schedule a task for reIndexing a single email in all the mailboxes containing it.</p>
<p>Note that &#x2018;messageId&#x2019; path parameter needs to be a (implementation dependent) valid messageId.</p>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Error in the request. Details can be found in the reported error.</li>
</ul>
<p>The scheduled task will have the following type <tt>MessageIdReIndexingTask</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;messageId&quot;:&quot;18&quot;
}
</pre></div></div>
<p>Warning: During the re-indexing, the result of search operations might be altered.</p></div></div>
<div class="section">
<h2><a name="Task_management"></a>Task management</h2>
<p>Some webadmin features schedules tasks. The task management API allow to monitor and manage the execution of the following tasks.</p>
<p>Note that the <tt>taskId</tt> used in the following APIs is returned by other WebAdmin APIs scheduling tasks.</p>

<ul>
  
<li><a href="#Getting_a_task_details">Getting a task details</a></li>
  
<li><a href="#Awaiting_a_task">Awaiting a task</a></li>
  
<li><a href="#Cancelling_a_task">Cancelling a task</a></li>
  
<li><a href="#Listing_tasks">Listing tasks</a></li>
</ul>
<div class="section">
<h3><a name="Getting_a_task_details"></a>Getting a task details</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>An Execution Report will be returned:</p>

<div class="source">
<div class="source">
<pre>{
    &quot;submitDate&quot;: &quot;2017-12-27T15:15:24.805+0700&quot;,
    &quot;startedDate&quot;: &quot;2017-12-27T15:15:24.809+0700&quot;,
    &quot;completedDate&quot;: &quot;2017-12-27T15:15:24.815+0700&quot;,
    &quot;cancelledDate&quot;: null,
    &quot;failedDate&quot;: null,
    &quot;taskId&quot;: &quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;,
    &quot;additionalInformation&quot;: {},
    &quot;status&quot;: &quot;completed&quot;,
    &quot;type&quot;: &quot;typeOfTheTask&quot;
}
</pre></div></div>
<p>Note that:</p>

<ul>
  
<li>
<p><tt>status</tt> can have the value:</p>
  
<ul>
    
<li><tt>waiting</tt>: The task is scheduled but its execution did not start yet</li>
    
<li><tt>inProgress</tt>: The task is currently executed</li>
    
<li><tt>cancelled</tt>: The task had been cancelled</li>
    
<li><tt>completed</tt>: The task execution is finished, and this execution is a success</li>
    
<li><tt>failed</tt>: The task execution is finished, and this execution is a failure</li>
  </ul></li>
  
<li>
<p><tt>additionalInformation</tt> is a task specific object giving additional information and context about that task. The structure  of this <tt>additionalInformation</tt> field is provided along the specific task submission endpoint.</p></li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>200: The specific task was found and the execution report exposed above is returned</li>
  
<li>400: Invalid task ID</li>
  
<li>404: Task ID was not found</li>
</ul></div>
<div class="section">
<h3><a name="Awaiting_a_task"></a>Awaiting a task</h3>
<p>One can await the end of a task, then receive it&#x2019;s final execution report.</p>
<p>That feature is especially usefull for testing purpose but still can serve real-life scenari.</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2/await
</pre></div></div>
<p>An Execution Report will be returned.</p>
<p>Response codes:</p>

<ul>
  
<li>200: The specific task was found and the execution report exposed above is returned</li>
  
<li>400: Invalid task ID</li>
  
<li>404: Task ID was not found</li>
</ul></div>
<div class="section">
<h3><a name="Cancelling_a_task"></a>Cancelling a task</h3>
<p>You can cancel a task by calling:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:  - 204: Task had been cancelled  - 400: Invalid task ID</p></div>
<div class="section">
<h3><a name="Listing_tasks"></a>Listing tasks</h3>
<p>A list of all tasks can be retrieved:</p>

<div class="source">
<div class="source">
<pre>curl -XGET /tasks
</pre></div></div>
<p>Will return a list of Execution reports</p>
<p>One can filter the above results by status. For example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET /tasks?status=inProgress
</pre></div></div>
<p>Will return a list of Execution reports that are currently in progress.</p>
<p>Response codes:</p>

<ul>
  
<li>200: A list of corresponding tasks is returned</li>
  
<li>400: Invalid status value</li>
</ul></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                    2006-2019
                        <a href="https://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
