<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.    
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at 2018-01-18 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Apache James Project &#x2013; Web administration for JAMES</title>
    <style type="text/css" media="all">
      @import url("../css/james.css");
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
      @import url("../js/jquery/css/custom-theme/jquery-ui-1.8.5.custom.css");
      @import url("../js/jquery/css/print.css");
      @import url("../js/fancybox/jquery.fancybox-1.3.4.css");
    </style>
    <script type="text/javascript" src="../js/jquery/js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="../js/jquery/js/jquery-ui-1.8.5.custom.min.js"></script>
    <script type="text/javascript" src="../js/fancybox/jquery.fancybox-1.3.4.js"></script>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20180118" />
    <meta http-equiv="Content-Language" content="en" />
        
          <!-- Google Analytics -->
    <script type="text/javascript">
    
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1384591-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script').item(0); s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../index.html" id="bannerLeft" title="james-logo.png">
              
                                                                            
        <img src="../images/logos/james-logo.png" alt="James Project" />
                </a>
                              <a href="http://www.apache.org/index.html" id="bannerRight">
              
                                        
        <img src="images/logos/asf_logo_small.png" alt="The Apache Software Foundation" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 2018-01-18</span>
                      </div>
            <div class="xright">                    <a href="../index.html" title="Home">Home</a>
            |
                        <a href="../documentation.html" title="James">James</a>
            |
                        <a href="../mime4j/index.html" title="Mime4J">Mime4J</a>
            |
                        <a href="../jsieve/index.html" title="jSieve">jSieve</a>
            |
                        <a href="../jspf/index.html" title="jSPF">jSPF</a>
            |
                        <a href="../jdkim/index.html" title="jDKIM">jDKIM</a>
            |
                        <a href="../hupa/index.html" title="Hupa">Hupa</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>James components</h5>
                  <ul>
                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../documentation.html" title="About James">About James</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <li class="expanded">
                          <a href="../server/index.html" title="Server">Server</a>
                    <ul>
                      <li class="none">
                          <a href="../server/advantages.html" title="Advantages">Advantages</a>
            </li>
                      <li class="none">
                          <a href="../server/objectives.html" title="Objectives">Objectives</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="expanded">
                          <a href="../server/quick-start.html" title="User Manual">User Manual</a>
                    <ul>
                                                                                                                                                                                    <li class="collapsed">
                          <a href="../server/features.html" title="1. Features">1. Features</a>
                  </li>
                      <li class="none">
                          <a href="../server/packaging.html" title="2. Packaging">2. Packaging</a>
            </li>
                                                                                                            <li class="collapsed">
                          <a href="../server/install.html" title="3. Install James">3. Install James</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                <li class="collapsed">
                          <a href="../server/config.html" title="4. Configure James">4. Configure James</a>
                  </li>
                                                                                                                      <li class="expanded">
                          <a href="../server/manage.html" title="5. Manage">5. Manage</a>
                    <ul>
                      <li class="none">
            <strong>WebAdmin</strong>
          </li>
                      <li class="none">
                          <a href="../server/manage-cli.html" title="Command line">Command line</a>
            </li>
                      <li class="none">
                          <a href="../server/metrics.html" title="Metrics">Metrics</a>
            </li>
              </ul>
        </li>
                                                                                                            <li class="collapsed">
                          <a href="../server/monitor.html" title="6. Monitor">6. Monitor</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../server/upgrade.html" title="7. Upgrade">7. Upgrade</a>
                  </li>
                                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../server/dev.html" title="8. Developers Corner">8. Developers Corner</a>
                  </li>
              </ul>
        </li>
                      <li class="none">
                          <a href="../mail.html#James_Mailing_lists" title="Mailing Lists">Mailing Lists</a>
            </li>
                      <li class="none">
                          <a href="../server/release-notes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../server/apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
                      <li class="none">
                          <a href="https://issues.apache.org/jira/browse/JAMES" title="Issue Tracker">Issue Tracker</a>
            </li>
                      <li class="none">
                          <a href="https://github.com/apache/james-project" title="Sources">Sources</a>
            </li>
                      <li class="none">
                          <a href="../server/rfcs.html" title="RFCs">RFCs</a>
            </li>
                      <li class="none">
                          <a href="../server/other-versions.html" title="Other versions">Other versions</a>
            </li>
                      <li class="none">
                          <a href="../download.cgi#Apache_James_Server" title="Download releases">Download releases</a>
            </li>
              </ul>
        </li>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../mailet/index.html" title="Mailets">Mailets</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../mailbox/index.html" title="Mailbox">Mailbox</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../protocols/index.html" title="Protocols">Protocols</a>
                  </li>
                                                                                                                                                                                                        <li class="collapsed">
                          <a href="../mpt/index.html" title="MPT">MPT</a>
                  </li>
          </ul>
        <h5>Apache Software Foundation</h5>
  <ul>
    <li>
      <strong>
        <a title="ASF" href="http://www.apache.org/">ASF</a>
      </strong>
    </li>
    <li>
      <a title="Get Involved" href="http://www.apache.org/foundation/getinvolved.html">Get Involved</a>
    </li>
    <li>
      <a title="FAQ" href="http://www.apache.org/foundation/faq.html">FAQ</a>
    </li>
    <li>
      <a title="License" href="http://www.apache.org/licenses/" >License</a>
    </li>
    <li>
      <a title="Sponsorship" href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
    </li>
    <li>
      <a title="Thanks" href="http://www.apache.org/foundation/thanks.html">Thanks</a>
    </li>
    <li>
      <a title="Security" href="http://www.apache.org/security/">Security</a>
    </li>
  </ul>
                       <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Web administration for JAMES</h1>
<p>The web administration supports for now the CRUD operations on the domains,the users, their mailboxes and their quotas, as described in the following sections.</p>
<p><b>WARNING</b>: This API allow authentication only via the use of JWT. If not configured with JWT, an administrator should ensure an attacker can not use this API.</p>
<p>Please also note <b>webadmin</b> is only enabled with <b>Guice</b>. You can not use it when using James with <b>Spring</b>, as the required injections are not implemented.</p>
<p>In case of any error, the system will return an error message which is json format like this:</p>

<div class="source">
<div class="source">
<pre>{
    statusCode: &lt;error_code&gt;,
    type: &lt;error_type&gt;,
    message: &lt;the_error_message&gt;
    cause: &lt;the_detail_message_from_throwable&gt;
}
</pre></div></div>
<div class="section">
<h2><a name="Administrating_domains"></a>Administrating domains</h2>
<div class="section">
<h3><a name="Create_a_domain"></a>Create a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/domains/domainToBeCreated
</pre></div></div>
<p>Resource name domainToBeCreated:</p>

<ul>
  
<li>can not be null or empty</li>
  
<li>can not contain &#x2018;@&#x2019;</li>
  
<li>can not be more than 255 characters</li>
  
<li>can not contain &#x2018;/&#x2019;</li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>204: The domain was successfully added</li>
  
<li>400: The domain name is invalid</li>
  
<li>500: Internal error while adding the domain</li>
</ul></div>
<div class="section">
<h3><a name="Delete_a_domain"></a>Delete a domain</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/domains/domainToBeDeleted
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The domain was successfully removed</li>
  
<li>500: Internal error while removing the domain</li>
</ul></div>
<div class="section">
<h3><a name="Test_if_a_domain_exists"></a>Test if a domain exists</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/domains/domainName
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The domain exists</li>
  
<li>404: The domain does not exist</li>
  
<li>500: Internal error while accessing the domains</li>
</ul></div>
<div class="section">
<h3><a name="Get_the_list_of_domains"></a>Get the list of domains</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/domains
</pre></div></div>
<p>Possible response:</p>

<div class="source">
<div class="source">
<pre>{&quot;domains&quot;:[&quot;domain1&quot;, &quot;domain2&quot;]}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The domain list was successfully retrieved</li>
  
<li>500: Internal error while accessing the domains</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_users"></a>Administrating users</h2>
<div class="section">
<h3><a name="Create_a_user"></a>Create a user</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/users/usernameToBeUsed -d '{&quot;password&quot;:&quot;passwordToBeUsed&quot;}'
</pre></div></div>
<p>Resource name usernameToBeUsed:</p>

<ul>
  
<li>can not be null or empty</li>
  
<li>can not be more than 255 characters</li>
  
<li>can not contain &#x2018;/&#x2019;</li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>204: The user was successfully created</li>
  
<li>400: The user name or the payload is invalid</li>
  
<li>409: Conflict: A concurrent modification make that query to fail</li>
  
<li>500: Internal error while adding the user</li>
</ul>
<p>Note: if the user is already, its password will be updated.</p></div>
<div class="section">
<h3><a name="Updating_a_user_password"></a>Updating a user password</h3>
<p>Same than Create, but a user need to exist.</p>
<p>If the user do not exist, then it will be created.</p></div>
<div class="section">
<h3><a name="Deleting_a_user"></a>Deleting a user</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/userToBeDeleted
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: The user was successfully deleted</li>
  
<li>500: Internal error while deleting the user</li>
</ul></div>
<div class="section">
<h3><a name="Retrieving_the_user_list"></a>Retrieving the user list</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[{&quot;username&quot;:&quot;username@domain-jmapauthentication.tld&quot;},{&quot;username&quot;:&quot;username@domain.tld&quot;}]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: The user name list was successfully retrieved</li>
  
<li>500: Internal error while retrieving the users</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_user_mailboxes"></a>Administrating user mailboxes</h2>
<div class="section">
<h3><a name="Creating_a_mailbox"></a>Creating a mailbox</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty, nor contain # &amp; % * characters.</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox now exists on the server</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist</li>
  
<li>500: Internal error</li>
</ul>
<p>To create nested mailboxes, for instance a work mailbox inside the INBOX mailbox, people should use the . separator. The sample query is:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes/INBOX.work
</pre></div></div></div>
<div class="section">
<h3><a name="Deleting_a_mailbox_and_its_children"></a>Deleting a mailbox and its children</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox now does not exist on the server</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Testing_existence_of_a_mailbox"></a>Testing existence of a mailbox</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users/usernameToBeUsed/mailboxes/mailboxNameToBeCreated
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user Resource name mailboxNameToBeCreated should not be empty</p>
<p>Response codes:</p>

<ul>
  
<li>204: The mailbox exists</li>
  
<li>400: Invalid mailbox name</li>
  
<li>404: The user name does not exist, the mailbox does not exist</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Listing_user_mailboxes"></a>Listing user mailboxes</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/users/usernameToBeUsed/mailboxes
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>[{&quot;mailboxName&quot;:&quot;INBOX&quot;},{&quot;mailboxName&quot;:&quot;outbox&quot;}]
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>200: The mailboxes list was successfully retrieved</li>
  
<li>404: The user name does not exist</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Deleting_user_mailboxes"></a>Deleting user mailboxes</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/users/usernameToBeUsed/mailboxes
</pre></div></div>
<p>Resource name usernameToBeUsed should be an existing user</p>
<p>Response codes:</p>

<ul>
  
<li>204: The user do not have mailboxes anymore</li>
  
<li>404: The user name does not exist</li>
  
<li>500: Internal error</li>
</ul></div></div>
<div class="section">
<h2><a name="Administrating_quotas"></a>Administrating quotas</h2>
<p>A quota with a value of -1 means unlimited</p>
<div class="section">
<h3><a name="Reading_per_quotaroot_mail_count_limitation"></a>Reading per quotaroot mail count limitation</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/count
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>100000
</pre></div></div>
<p>Response codes:  - 200: Nothing special  - 500: Internal error</p></div>
<div class="section">
<h3><a name="Updating_per_quotaroot_mail_count_limitation"></a>Updating per quotaroot mail count limitation</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/count -d '1024000000'
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: Value updated</li>
  
<li>400: The body is not a positive integer</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Removing_per_quotaroot_mail_count_limitation"></a>Removing per quotaroot mail count limitation</h3>
<p>It removes the limitation, and the quota becomes UNILIMITED.</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/count
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: Value updated to UNLIMITED</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Reading_per_quotaroot_size_limitation"></a>Reading per quotaroot size limitation</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/size
</pre></div></div>
<p>The answer looks like:</p>

<div class="source">
<div class="source">
<pre>100000
</pre></div></div>
<p>It represent the allowed Byte count of the mailboxes belonging to this quotaroot.</p>
<p>Response codes:</p>

<ul>
  
<li>200: Nothing special</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Updating_per_quotaroot_size_limitation"></a>Updating per quotaroot size limitation</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/size -d '1024000000'
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: Value updated</li>
  
<li>400: The body is not a positive integer</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Removing_per_quotaroot_size_limitation"></a>Removing per quotaroot size limitation</h3>
<p>It removes the limitation, and the quota becomes UNILIMITED.</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/quota/size
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: Value updated to UNLIMITED</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Managing_count_and_size_at_the_same_time"></a>Managing count and size at the same time</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/quota/
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>{&quot;count&quot;:52,&quot;size&quot;:42}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>500: Internal error</li>
</ul>
<p>You can also write the value the same way:</p>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/quota/ -d '{&quot;count&quot;:52,&quot;size&quot;:42}'
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>204: Success</li>
  
<li>400: Invalid JSON, or numbers are less than -1.</li>
  
<li>500: Internal error</li>
</ul></div></div>
<div class="section">
<h2><a name="Cassandra_Schema_upgrades"></a>Cassandra Schema upgrades</h2>
<p>Cassandra upgrades implies the creation of a new table. Thus restarting James is needed, as new tables are created on restart.</p>
<p>Once done, we ship code that tries to read from new tables, and if not possible backs up to old tables. You can thus safely run without running additional migrations.</p>
<p>On the fly migration can be enabled. However, one might want to force the migration in a controlled fashion, and update automatically current schema version used (assess in the database old versions is no more used, as the corresponding tables are empty). Note that this process is safe: we ensure the service is not running concurrently on this James instance, that it does not bump version upon partial failures, that race condition in version upgrades will be idempotent, etc&#x2026;</p>
<p>These schema updates can be triggered by webadmin using the Cassandra backend.</p>
<p>Note that currently the progress can be tracked by logs.</p>
<div class="section">
<h3><a name="Retrieving_current_Cassandra_schema_version"></a>Retrieving current Cassandra schema version</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/cassandra/version
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>2
</pre></div></div>
<p>Where the number corresponds to the current schema version of the database you are using.</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Retrieving_latest_available_Cassandra_schema_version"></a>Retrieving latest available Cassandra schema version</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/cassandra/version
</pre></div></div>
<p>Will return:</p>

<div class="source">
<div class="source">
<pre>3
</pre></div></div>
<p>Where the number corresponds to the latest available schema version of the database you are using. This means you can be migrating to this schema version.</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Upgrading_to_a_specific_version"></a>Upgrading to a specific version</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/version/upgrade -d '3'
</pre></div></div>
<p>Will schedule the run of the migrations you need to reach schema version 3. The <tt>taskId</tt> will allow you to monitor and manage this process.</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;}
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success. The scheduled task taskId is returned.</li>
  
<li>400: The version is invalid. The version should be a strictly positive number.</li>
  
<li>410: Error while planning this migration. This resource is gone away. Reason is mentionned in the body.</li>
  
<li>500: Internal error while creating the migration task.</li>
</ul>
<p>Note that several calls to this endpoint will be run in a sequential pattern.</p>
<p>If the server restarts during the migration, the migration is silently aborted.</p>
<p>The scheduled task will have the following type <tt>CassandraMigration</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{&quot;toVersion&quot;:3}
</pre></div></div></div>
<div class="section">
<h3><a name="Upgrading_to_the_latest_version"></a>Upgrading to the latest version</h3>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/version/upgrade/latest
</pre></div></div>
<p>Will schedule the run of the migrations you need to reach the latest schema version. The <tt>taskId</tt> will allow you to monitor and manage this process.</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success. The scheduled task taskId is returned.</li>
  
<li>410: Error while planning this migration. This resource is gone away. Reason is mentionned in the body.</li>
  
<li>500: Internal error while creating the migration task.</li>
</ul>
<p>Note that several calls to this endpoint will be run in a sequential pattern.</p>
<p>If the server restarts during the migration, the migration is silently aborted.</p>
<p>The scheduled task will have the following type <tt>CassandraMigration</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{&quot;toVersion&quot;:2}
</pre></div></div></div></div>
<div class="section">
<h2><a name="Correcting_ghost_mailbox"></a>Correcting ghost mailbox</h2>
<p>This is a temporary workaround for the <b>Ghost mailbox</b> bug encountered using the Cassandra backend, as described in MAILBOX-322.</p>
<p>You can use the mailbox merging feature in order to merge the old &#x201c;ghosted&#x201d; mailbox with the new one.</p>

<div class="source">
<div class="source">
<pre>curl -XPOST http://ip:port/cassandra/mailbox/merging -d '{&quot;mergeOrigin&quot;:&quot;id1&quot;, &quot;mergeDestination&quot;:&quot;id2&quot;}'
</pre></div></div>
<p>Will scedule a task for :</p>

<ul>
  
<li>Delete references to <tt>id1</tt> mailbox</li>
  
<li>Move it&#x2019;s messages into <tt>id2</tt> mailbox</li>
  
<li>Union the rights of both mailboxes</li>
</ul>
<p>The response to that request will be the scheduled <tt>taskId</tt> :</p>

<div class="source">
<div class="source">
<pre>{&quot;taskId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;}
</pre></div></div>
<p>Positionned headers:</p>

<ul>
  
<li>Location header indicates the location of the resource associated with the scheduled task. Example:</li>
</ul>

<div class="source">
<div class="source">
<pre>Location: /tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>201: Success. Corresponding task id is returned.</li>
  
<li>400: Unable to parse the body.</li>
</ul>
<p>The scheduled task will have the following type <tt>mailboxMerging</tt> and the following <tt>additionalInformation</tt>:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;oldMailboxId&quot;:&quot;5641376-02ed-47bd-bcc7-76ff6262d92a&quot;,
  &quot;newMailboxId&quot;:&quot;4555159-52ae-895f-ccb7-586a4412fb50&quot;,
  &quot;totalMessageCount&quot;: 1,
  &quot;messageMovedCount&quot;: 1,
  &quot;messageFailedCount&quot;: 0
}
</pre></div></div></div>
<div class="section">
<h2><a name="Creating_address_group"></a>Creating address group</h2>
<p>You can use <b>webadmin</b> to define address groups.</p>
<p>When a specific email is sent to the group mail address, every group member will receive it.</p>
<p>This feature uses <a href="/server/config-recipientrewritetable.html">Recipients rewrite table</a> and requires the <a class="externalLink" href="https://github.com/apache/james-project/blob/master/server/mailet/mailets/src/main/java/org/apache/james/transport/mailets/RecipientRewriteTable.java">RecipientRewriteTable mailet</a> to be configured.</p>
<p>Note that email addresses are restricted to ASCII character set. Mail addresses not matching this criteria will be rejected.</p>
<div class="section">
<h3><a name="Listing_groups"></a>Listing groups</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/groups
</pre></div></div>
<p>Will return the groups as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;group1@domain.com&quot;, &quot;group2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Listing_members_of_a_group"></a>Listing members of a group</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/address/groups/group@domain.com
</pre></div></div>
<p>Will return the group members as a list of JSON Strings representing mail addresses. For instance:</p>

<div class="source">
<div class="source">
<pre>[&quot;member1@domain.com&quot;, &quot;member2@domain.com&quot;]
</pre></div></div>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Group structure is not valid</li>
  
<li>404: The group does not exist</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Adding_a_group_member"></a>Adding a group member</h3>

<div class="source">
<div class="source">
<pre>curl -XPUT http://ip:port/address/groups/group@domain.com/member@domain.com
</pre></div></div>
<p>Will add <a class="externalLink" href="mailto:member@domain.com">member@domain.com</a> to <a class="externalLink" href="mailto:group@domain.com">group@domain.com</a>, creating the group if needed</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Group structure or member is not valid</li>
  
<li>403: Server does not own the requested domain</li>
  
<li>409: Requested group address is already used for another purpose</li>
  
<li>500: Internal error</li>
</ul></div>
<div class="section">
<h3><a name="Removing_a_group_member"></a>Removing a group member</h3>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/address/groups/group@domain.com/member@domain.com
</pre></div></div>
<p>Will remove <a class="externalLink" href="mailto:member@domain.com">member@domain.com</a> from <a class="externalLink" href="mailto:group@domain.com">group@domain.com</a>, removing the group if group is empty after deletion</p>
<p>Response codes:</p>

<ul>
  
<li>200: Success</li>
  
<li>400: Group structure or member is not valid</li>
  
<li>500: Internal error</li>
</ul></div></div>
<div class="section">
<h2><a name="Task_management"></a>Task management</h2>
<p>Some webadmin features schedules tasks. The task management API allow to monitor and manage the execution of the following tasks.</p>
<p>Note that the <tt>taskId</tt> used in the following APIs is returned by other WebAdmin APIs scheduling tasks.</p>
<div class="section">
<h3><a name="Getting_a_task_details"></a>Getting a task details</h3>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>An Execution Report will be returned:</p>

<div class="source">
<div class="source">
<pre>{
    &quot;submitDate&quot;: &quot;2017-12-27T15:15:24.805+0700&quot;,
    &quot;startedDate&quot;: &quot;2017-12-27T15:15:24.809+0700&quot;,
    &quot;completedDate&quot;: &quot;2017-12-27T15:15:24.815+0700&quot;,
    &quot;cancelledDate&quot;: null,
    &quot;failedDate&quot;: null,
    &quot;taskId&quot;: &quot;3294a976-ce63-491e-bd52-1b6f465ed7a2&quot;,
    &quot;additionalInformation&quot;: {},
    &quot;status&quot;: &quot;completed&quot;,
    &quot;type&quot;: &quot;typeOfTheTask&quot;
}
</pre></div></div>
<p>Note that:</p>

<ul>
  
<li>
<p><tt>status</tt> can have the value:</p>
  
<ul>
    
<li><tt>waiting</tt>: The task is scheduled but its execution did not start yet</li>
    
<li><tt>inProgress</tt>: The task is currently executed</li>
    
<li><tt>cancelled</tt>: The task had been cancelled</li>
    
<li><tt>completed</tt>: The task execution is finished, and this execution is a success</li>
    
<li><tt>failed</tt>: The task execution is finished, and this execution is a failure</li>
  </ul></li>
  
<li>
<p><tt>additionalInformation</tt> is a task specific object giving additional information and context about that task. The structure  of this <tt>additionalInformation</tt> field is provided along the specific task submission endpoint.</p></li>
</ul>
<p>Response codes:</p>

<ul>
  
<li>200: The specific task was found and the execution report exposed above is returned</li>
  
<li>400: Invalid task ID</li>
  
<li>404: Task ID was not found</li>
</ul></div>
<div class="section">
<h3><a name="Awaiting_a_task"></a>Awaiting a task</h3>
<p>One can await the end of a task, then receive it&#x2019;s final execution report.</p>
<p>That feature is especially usefull for testing purpose but still can serve real-life scenari.</p>

<div class="source">
<div class="source">
<pre>curl -XGET http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2/await
</pre></div></div>
<p>An Execution Report will be returned.</p>
<p>Response codes:</p>

<ul>
  
<li>200: The specific task was found and the execution report exposed above is returned</li>
  
<li>400: Invalid task ID</li>
  
<li>404: Task ID was not found</li>
</ul></div>
<div class="section">
<h3><a name="Cancelling_a_task"></a>Cancelling a task</h3>
<p>You can cancel a task by calling:</p>

<div class="source">
<div class="source">
<pre>curl -XDELETE http://ip:port/tasks/3294a976-ce63-491e-bd52-1b6f465ed7a2
</pre></div></div>
<p>Response codes:  - 204: Task had been cancelled  - 400: Invalid task ID</p></div>
<div class="section">
<h3><a name="Listing_tasks"></a>Listing tasks</h3>
<p>A list of all tasks can be retrieved:</p>

<div class="source">
<div class="source">
<pre>curl -XGET /tasks
</pre></div></div>
<p>Will return a list of Execution reports</p>
<p>One can filter the above results by status. For example:</p>

<div class="source">
<div class="source">
<pre>curl -XGET /tasks?status=inProgress
</pre></div></div>
<p>Will return a list of Execution reports that are currently in progress.</p>
<p>Response codes:</p>

<ul>
  
<li>200: A list of corresponding tasks is returned</li>
  
<li>400: Invalid status value</li>
</ul></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                    2006-2018
                        <a href="https://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
